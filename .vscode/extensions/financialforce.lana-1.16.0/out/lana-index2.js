"use strict";let e;var t,r,s,n,i,o,a,c,l,u,h,d,p,m,f,g,v,y=require("./lana-_commonjsHelpers.js"),b=require("fs"),T=require("util"),E=require("path"),R=require("readline"),C=require("./lana-exported.js"),S=require("os"),_=require("tty"),O=require("events"),w=require("assert"),x={},I={},A={},L=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0}),A.CancellationTokenSource=void 0;let Token=class Token{constructor(){this.isCancellationRequested=!1,this.callbacks=[]}onCancellationRequested(e){this.isCancellationRequested?e():this.callbacks.push(e)}};let CancellationTokenSource=class CancellationTokenSource{constructor(){this.token=new Token}asyncCancel(){return L(this,void 0,void 0,function*(){for(let e of(this.token.isCancellationRequested=!0,this.token.callbacks))yield e();this.token.callbacks=[]})}};A.CancellationTokenSource=CancellationTokenSource,Object.defineProperty(I,"__esModule",{value:!0}),I.CancellationTokenSource=void 0,Object.defineProperty(I,"CancellationTokenSource",{enumerable:!0,get:function(){return A.CancellationTokenSource}});var k={},P={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.xmlCharMap=j.soapTemplate=j.action=j.soapHeader=j.soapBody=j.soapEnv=void 0,j.soapEnv="soapenv:Envelope",j.soapBody="soapenv:Body",j.soapHeader="soapenv:Header",j.action="executeAnonymous",j.soapTemplate=`<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema"
xmlns:env="http://schemas.xmlsoap.org/soap/envelope/"
xmlns:cmd="http://soap.sforce.com/2006/08/apex"
xmlns:apex="http://soap.sforce.com/2006/08/apex">
    <env:Header>
        <cmd:SessionHeader>
            <cmd:sessionId>%s</cmd:sessionId>
        </cmd:SessionHeader>
        %s
    </env:Header>
    <env:Body>
        <%s xmlns="http://soap.sforce.com/2006/08/apex">
            %s
        </%s>
    </env:Body>
</env:Envelope>`,j.xmlCharMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"};var N={},M={};Object.defineProperty(M,"__esModule",{value:!0}),M.messages=void 0,M.messages={unexpectedExecuteCommandError:"Unexpected error while executing anonymous apex. %s",fileNotFoundError:"File not found at the specified path: %s",missingInfoLogError:"To retrieve logs, specify the log ID or the number of logs.",numLogsError:"Expected number of logs to be greater than 0.",optionExecAnonError:"Please specify an option to execute anonymous Apex.",unexpectedExecAnonInputError:"Unexpected error while reading user input. %s",coverageReportCreationError:"Unexpected error occurred while creating coverage reports. %s",execAnonInputPrompt:"Start typing Apex code. Press the Enter key after each line, then press CTRL+D when finished.\n",execAnonInputTimeout:"Timed out while waiting for user input.",noTestResultSummary:"No test results were found for test run %s",noTestQueueResults:"No test results were found in the queue for test run %s",noAccessTokenFound:"No access token could be found for the provided username",streamingHandshakeFail:"Test run handshake failed: %s",streamingTransportUp:"Listening for streaming state changes...",streamingTransportDown:"Faye client generated a transport:down event.",streamingProcessingTestRun:"Processing test run %s",retrievingTestRunSummary:"Retrieving test run summary record",queryingForAggregateCodeCoverage:"Querying for aggregate code coverage results",abortingTestRun:"Aborting test run %s",abortingTestRunRequested:"Test run %s is aborted",failRate:"Fail Rate",testsRan:"Tests Ran",orgId:"Org Id",outcome:"Outcome",passRate:"Pass Rate",skipRate:"Skip Rate",testStartTime:"Test Start Time",testExecutionTime:"Test Execution Time",testRunId:"Test Run Id",userId:"User Id",username:"Username",orgWideCoverage:"Org Wide Coverage",nameColHeader:"NAME",valueColHeader:"VALUE",testSummaryHeader:"Test Summary",testNameColHeader:"TEST NAME",outcomeColHeader:"OUTCOME",msgColHeader:"MESSAGE",runtimeColHeader:"RUNTIME (MS)",testResultsHeader:"Test Results",classesColHeader:"CLASSES",percentColHeader:"PERCENT",classTestedHeader:"CLASS BEING TESTED",uncoveredLinesColHeader:"UNCOVERED LINES",codeCovHeader:"Apex Code Coverage by Class",detailedCodeCovHeader:"Apex Code Coverage for Test Run %s",syncClassErr:"Synchronous test runs can include test methods from only one Apex class. Omit the --synchronous flag or include tests from only one class",resultFormatErr:"Specified result formats must be of type json, junit, or tap",invalidTestRunIdErr:'The test run id %s isn\'t in the correct format for "id." The ID is a 15- or 18-character string in the format "707xxxxxxxxxxxx"',invalidsObjectErr:`You don't have permissions to access sObject of type %s. Ask your Salesforce admin to give you permissions to access Apex code and the Streaming API. 
Error: %s`,payloadErr:"Specify a test class or test methods when running tests synchronously",suitenameErr:"Must provide a suite name or suite id to retrieve test classes in suite",missingSuiteErr:"Suite does not exist",missingTestClassErr:"Apex class %s does not exist in the org",testSuiteMsg:"Apex test class %s already exists in Apex test suite %s",classSuiteMsg:"Added Apex class %s to your Apex test suite %s",error_no_default_username:'No default org is set. Run "SFDX: Create a Default Scratch Org" or "SFDX: Authorize an Org" to set one.',trace_flags_unknown_user:"Unknown user",trace_flags_failed_to_create_debug_level:"Failed to create a debug level",trace_flags_failed_to_find_debug_level:"Debug Level not found for %s",runIdFormatErr:"Cannot specify a result format with a TestRunId result",covIdFormatErr:"Cannot specify code coverage with a TestRunId result",startHandshake:"Attempting StreamingClient handshake",finishHandshake:"Finished StreamingClient handshake",subscribeStarted:"Subscribing to ApexLog events"};var D={};Object.defineProperty(D,"__esModule",{value:!0}),D.Message=D.Localization=void 0;let Localization=class Localization{constructor(e){this.delegate=e}localize(e,t){return this.delegate.localize(e,t)}};D.Localization=Localization;let Message=class Message{constructor(e){this.messages=e}localize(e,t){let r=this.getLabel(e);if(void 0===t&&r)return r;if(void 0!==t&&Array.isArray(t)?t=t[0].constructor===Array?t[0]:t:void 0===t||Array.isArray(t)||(t=[t]),!r)return console.warn(`Missing label for key: ${e}`),r=`!!! MISSING LABEL !!! ${e}`,Array.isArray(t)&&t.length>=1&&t.forEach(e=>{r+=` (${e})`}),r;if(Array.isArray(t)&&t.length>=1){let s=r.split("%s").length-1;return t.length!==s&&console.log(`Arguments do not match for label '${e}', got ${t.length} but want ${s}`),t.unshift(r),T.format.apply(T,t)}return r}getLabel(e){return this.messages[e]?this.messages[e]:void 0}};D.Message=Message,Object.defineProperty(N,"__esModule",{value:!0}),N.Message=N.Localization=N.nls=void 0,N.nls=new D.Localization(function(){try{return new D.Message(M.messages)}catch(e){console.error("Cannot find messages in i18n module")}}()),Object.defineProperty(N,"Localization",{enumerable:!0,get:function(){return D.Localization}}),Object.defineProperty(N,"Message",{enumerable:!0,get:function(){return D.Message}});var F={},$={},U=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};function z(e){b.existsSync(e)||(z(E.dirname(e)),b.mkdirSync(e))}function G(e){z(E.dirname(e)),b.closeSync(b.openSync(e,"w"))}Object.defineProperty($,"__esModule",{value:!0}),$.createFiles=$.createFile=$.ensureFileExists=$.ensureDirectoryExists=void 0,$.ensureDirectoryExists=z,$.ensureFileExists=G,$.createFile=function(e,t){G(e),b.createWriteStream(e).write(t)},$.createFiles=function(e){return U(this,void 0,void 0,function*(){let t=e.map(e=>{G(e.path);let t=b.createWriteStream(e.path);return t.write(e.content),new Promise((e,r)=>{t.on("end",()=>{e()}),t.on("error",e=>{r(e)})})});yield Promise.all(t)})};var H={};Object.defineProperty(H,"__esModule",{value:!0}),H.Table=void 0;let Table=class Table{createTable(e,t,r){if(!e)throw Error("rows cannot be undefined");if(!t)throw Error("columns cannot be undefined");let s=this.calculateMaxColumnWidths(e,t),n=r?`=== ${r}`:"",i="",o="";return t.forEach((e,t,r)=>{let n=s.get(e.key);if(n){let s=t===r.length-1;i+=this.fillColumn(e.label||e.key,n," ",s),o+=this.fillColumn("",n,"â”€",s)}}),i&&o&&(n+=`${r?"\n":""}${i}
${o}
`),e.forEach(e=>{let r="";t.forEach((t,n,i)=>{let o=e[t.key],a=n===i.length-1,c=r.length;o.split("\n").forEach((e,n)=>{let i=s.get(t.key);i&&(0===n?r+=this.fillColumn(e,i," ",a):r+="\n"+this.fillColumn("",c," ",!0)+this.fillColumn(e,i," ",a))})}),n+=r+"\n"}),n}calculateMaxColumnWidths(e,t){let r=new Map;return t.forEach(t=>{e.forEach(e=>{let s=e[t.key];if(void 0===s)throw Error(`Row is missing the key ${t.key}`);let n=r.get(t.key);void 0===n&&(n=(t.label||t.key).length,r.set(t.key,n));let i=s.split("\n").reduce((e,t)=>t.length>e.length?t:e).length;i>n&&r.set(t.key,i)})}),r}fillColumn(e,t,r,s){let n=e;for(let s=0;s<t-e.length;s++)n+=r;return s||(n+="  "),n}};H.Table=Table;var q={};Object.defineProperty(q,"__esModule",{value:!0}),q.msToSecond=q.formatStartTime=q.getCurrentTime=q.MILLISECONDS_PER_MINUTE=void 0,q.MILLISECONDS_PER_MINUTE=6e4,q.getCurrentTime=function(){return new Date().getTime()},q.formatStartTime=function(e){let t=new Date(e);return`${t.toDateString()} ${t.toLocaleTimeString()}`},q.msToSecond=function(e){return(e/1e3).toFixed(2)};var W={},B={};Object.defineProperty(B,"__esModule",{value:!0}),B.xmlCharMap=void 0,(t=u||(u={})).trace="trace",t.debug="debug",t.info="info",t.warn="warn",t.error="error",t.fatal="fatal",B.xmlCharMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"};var V=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(W,"__esModule",{value:!0}),W.escapeXml=W.refreshAuth=void 0,W.refreshAuth=function(e){return V(this,void 0,void 0,function*(){let t={url:e.baseUrl(),method:"GET"};return yield e.request(t)})},W.escapeXml=function(e){return e.replace(/[<>&'"]/g,e=>B.xmlCharMap[e])},Object.defineProperty(F,"__esModule",{value:!0}),F.refreshAuth=F.msToSecond=F.formatStartTime=F.getCurrentTime=F.Table=F.createFile=void 0,Object.defineProperty(F,"createFile",{enumerable:!0,get:function(){return $.createFile}}),Object.defineProperty(F,"Table",{enumerable:!0,get:function(){return H.Table}}),Object.defineProperty(F,"getCurrentTime",{enumerable:!0,get:function(){return q.getCurrentTime}}),Object.defineProperty(F,"formatStartTime",{enumerable:!0,get:function(){return q.formatStartTime}}),Object.defineProperty(F,"msToSecond",{enumerable:!0,get:function(){return q.msToSecond}}),Object.defineProperty(F,"refreshAuth",{enumerable:!0,get:function(){return W.refreshAuth}});var Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.encodeBody=void 0,Q.encodeBody=function(e,t){let r=t.replace(/[<>&'"]/g,e=>j.xmlCharMap[e]),s=`<apexcode>${r}</apexcode>`;return T.format(j.soapTemplate,e,"<apex:DebuggingHeader><apex:debugLevel>DEBUGONLY</apex:debugLevel></apex:DebuggingHeader>",j.action,s,j.action)};var J=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(P,"__esModule",{value:!0}),P.ExecuteService=void 0;let ExecuteService=class ExecuteService{constructor(e){this.connection=e}executeAnonymous(e){return J(this,void 0,void 0,function*(){let t=yield this.getApexCode(e),r=0;for(;r<2;)try{let e=this.buildExecRequest(t),r=yield this.connectionRequest(e);return this.jsonFormat(r)}catch(e){if("ERROR_HTTP_500"===e.name&&e.message&&e.message.includes("INVALID_SESSION_ID"))yield(0,F.refreshAuth)(this.connection),r+=1;else throw Error(N.nls.localize("unexpectedExecuteCommandError",e.message))}})}getApexCode(e){return J(this,void 0,void 0,function*(){if(e.apexCode)return String(e.apexCode);if(e.apexFilePath)return this.readApexFile(e.apexFilePath);if(e.userInput)return yield this.getUserInput();throw Error(N.nls.localize("optionExecAnonError"))})}readApexFile(e){if(!(0,b.existsSync)(e))throw Error(N.nls.localize("fileNotFoundError",e));return(0,b.readFileSync)(e,"utf8")}getUserInput(){return J(this,void 0,void 0,function*(){return process.stdout.write(N.nls.localize("execAnonInputPrompt")),new Promise((e,t)=>{let r=R.createInterface(process.stdin,process.stdout),s=setTimeout(()=>{t(Error(N.nls.localize("execAnonInputTimeout"))),r.close()},6e4),n="";r.on("line",e=>{s.refresh(),n=n+e+"\n"}),r.on("close",()=>{e(n),clearTimeout(s)}),r.on("error",e=>{t(Error(N.nls.localize("unexpectedExecAnonInputError",e.message)))})})})}buildExecRequest(e){let t=(0,Q.encodeBody)(this.connection.accessToken,e);return{method:"POST",url:`${this.connection.instanceUrl}/services/Soap/s/${this.connection.version}/${this.connection.accessToken.split("!")[0]}`,body:t,headers:{"content-type":"text/xml",soapaction:j.action}}}jsonFormat(e){let t=e[j.soapEnv][j.soapBody].executeAnonymousResponse.result,r={compiled:"true"===t.compiled,success:"true"===t.success,logs:e[j.soapEnv][j.soapHeader].DebuggingInfo.debugLog};return r.success||(r.diagnostic=[{lineNumber:t.line,columnNumber:t.column,compileProblem:"object"==typeof t.compileProblem?"":t.compileProblem,exceptionMessage:"object"==typeof t.exceptionMessage?"":t.exceptionMessage,exceptionStackTrace:"object"==typeof t.exceptionStackTrace?"":t.exceptionStackTrace}]),r}connectionRequest(e){return J(this,void 0,void 0,function*(){return yield this.connection.request(e)})}};P.ExecuteService=ExecuteService,Object.defineProperty(k,"__esModule",{value:!0}),k.ExecuteService=void 0,Object.defineProperty(k,"ExecuteService",{enumerable:!0,get:function(){return P.ExecuteService}});var Y={},X={},K={};Object.defineProperty(K,"__esModule",{value:!0}),K.STREAMING_LOG_TOPIC=K.LISTENER_ABORTED_ERROR_NAME=K.LOG_TIMER_LENGTH_MINUTES=K.MAX_NUM_LOGS=K.LOG_TYPE=K.DEFAULT_DEBUG_LEVEL_NAME=void 0,K.DEFAULT_DEBUG_LEVEL_NAME="SFDC_DevConsole",K.LOG_TYPE="DEVELOPER_LOG",K.MAX_NUM_LOGS=25,K.LOG_TIMER_LENGTH_MINUTES=30,K.LISTENER_ABORTED_ERROR_NAME="streamListenerAborted",K.STREAMING_LOG_TOPIC="/systemTopic/Logging";var Z={},ee={},et={};Object.defineProperty(et,"__esModule",{value:!0}),et.TapReporter=void 0;let TapReporter=class TapReporter{format(e,t){let r=this.buildTapResults(e),s=r.length,n="";return n=n.concat(`1..${s}
`),r.forEach(e=>{n=n.concat(`${e.outcome} ${e.testNumber} ${e.description}
`),e.diagnostics.forEach(e=>{n=n.concat(`# ${e}
`)})}),null==t||t.forEach(e=>{n=n.concat(`# ${e}
`)}),n}buildTapResults(e){let t=[];return e.tests.forEach((e,r)=>{let s="Pass"===e.outcome?"ok":"not ok";t.push({testNumber:r+1,description:e.fullName,diagnostics:this.buildTapDiagnostics(e),outcome:s})}),t}buildTapDiagnostics(e){let t=[];return"Pass"!==e.outcome&&(e.message?new RegExp(/^[/\r\n|\r|\n][\w]*/gim).test(e.message)?e.message.split(/\r\n|\r|\n/g).forEach(e=>{e&&e.length>0&&t.push(e.trim())}):t.push(e.message):t.push("Unknown error"),e.stackTrace&&e.stackTrace.split("\n").forEach(e=>{t.push(e)})),t}};et.TapReporter=TapReporter;var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.JUnitReporter=void 0;const es="    ",en=["testExecutionTimeInMs","testTotalTimeInMs","commandTimeInMs"],ei=["skipRate","totalLines","linesCovered"];let JUnitReporter=class JUnitReporter{format(e){let{summary:t,tests:r}=e;return`<?xml version="1.0" encoding="UTF-8"?>
`+(`<testsuites>
${es}<testsuite name="force.apex" timestamp="${new Date(t.testStartTime).toISOString()}" hostname="${t.hostname}" tests="${t.testsRan}" failures="${t.failing}"  errors="0"  time="${(0,F.msToSecond)(t.testExecutionTimeInMs)}">
`+this.buildProperties(e)+this.buildTestCases(r)+`${es}</testsuite>
`)+`</testsuites>
`}buildProperties(e){let t=`${es}${es}<properties>
`;return Object.entries(e.summary).forEach(([e,r])=>{this.isEmpty(r)||ei.includes(e)||(en.includes(e)&&(r=`${(0,F.msToSecond)(r)} s`,e=e.replace("InMs","")),"outcome"===e&&"Passed"===r&&(r="Successful"),t+=`${es}${es}${es}<property name="${e}" value="${r}"/>
`)}),t+=`${es}${es}</properties>
`}buildTestCases(e){let t="";for(let r of e){let e=this.xmlEscape(r.methodName);if(t+=`${es}${es}<testcase name="${e}" classname="${r.apexClass.fullName}" time="${(0,F.msToSecond)(r.runTime)}">
`,"Fail"===r.outcome||"CompileFail"===r.outcome){let e=this.isEmpty(r.message)?"":r.message;e=this.xmlEscape(e),t+=`${es}${es}${es}<failure message="${e}">`,r.stackTrace&&(t+=`<![CDATA[${r.stackTrace}]]>`),t+=`</failure>
`}t+=`${es}${es}</testcase>
`}return t}xmlEscape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}isEmpty(e){return null==e||"string"==typeof e&&0===e.length}};er.JUnitReporter=JUnitReporter;var eo={};Object.defineProperty(eo,"__esModule",{value:!0}),eo.HumanReporter=void 0;let HumanReporter=class HumanReporter{format(e,t){let r=this.formatSummary(e);return e.codecoverage&&t||(r+=this.formatTestResults(e.tests)),e.codecoverage&&(t&&(r+=this.formatDetailedCov(e)),r+=this.formatCodeCov(e.codecoverage)),r}formatSummary(e){let t=new F.Table,r=[{name:N.nls.localize("outcome"),value:e.summary.outcome},{name:N.nls.localize("testsRan"),value:String(e.summary.testsRan)},{name:N.nls.localize("passRate"),value:e.summary.passRate},{name:N.nls.localize("failRate"),value:e.summary.failRate},{name:N.nls.localize("skipRate"),value:e.summary.skipRate},{name:N.nls.localize("testRunId"),value:e.summary.testRunId},{name:N.nls.localize("testExecutionTime"),value:`${e.summary.testExecutionTimeInMs} ms`},{name:N.nls.localize("orgId"),value:e.summary.orgId},{name:N.nls.localize("username"),value:e.summary.username},...e.summary.orgWideCoverage?[{name:N.nls.localize("orgWideCoverage"),value:String(e.summary.orgWideCoverage)}]:[]];return t.createTable(r,[{key:"name",label:N.nls.localize("nameColHeader")},{key:"value",label:N.nls.localize("valueColHeader")}],N.nls.localize("testSummaryHeader"))}formatTestResults(e){let t=new F.Table,r=[];return e.forEach(e=>{let t=e.stackTrace?`${e.message}
${e.stackTrace}`:e.message;r.push({name:e.fullName,outcome:e.outcome,msg:e.message?t:"",runtime:"Fail"!==e.outcome?`${e.runTime}`:""})}),"\n\n"+t.createTable(r,[{key:"name",label:N.nls.localize("testNameColHeader")},{key:"outcome",label:N.nls.localize("outcomeColHeader")},{key:"msg",label:N.nls.localize("msgColHeader")},{key:"runtime",label:N.nls.localize("runtimeColHeader")}],N.nls.localize("testResultsHeader"))}formatDetailedCov(e){let t=new F.Table,r=[];return e.tests.forEach(e=>{let t=e.stackTrace?`${e.message}
${e.stackTrace}`:e.message;e.perClassCoverage?e.perClassCoverage.forEach(s=>{r.push({name:e.fullName,coveredClassName:s.apexClassOrTriggerName,outcome:e.outcome,coveredClassPercentage:s.percentage,msg:e.message?t:"",runtime:`${e.runTime}`})}):r.push({name:e.fullName,coveredClassName:"",outcome:e.outcome,coveredClassPercentage:"",msg:e.message?t:"",runtime:`${e.runTime}`})}),"\n\n"+t.createTable(r,[{key:"name",label:N.nls.localize("testNameColHeader")},{key:"coveredClassName",label:N.nls.localize("classTestedHeader")},{key:"outcome",label:N.nls.localize("outcomeColHeader")},{key:"coveredClassPercentage",label:N.nls.localize("percentColHeader")},{key:"msg",label:N.nls.localize("msgColHeader")},{key:"runtime",label:N.nls.localize("runtimeColHeader")}],N.nls.localize("detailedCodeCovHeader",[e.summary.testRunId]))}formatCodeCov(e){let t=new F.Table,r=[];return e.forEach(e=>{r.push({name:e.name,percent:e.percentage,uncoveredLines:this.formatUncoveredLines(e.uncoveredLines)})}),"\n\n"+t.createTable(r,[{key:"name",label:N.nls.localize("classesColHeader")},{key:"percent",label:N.nls.localize("percentColHeader")},{key:"uncoveredLines",label:N.nls.localize("uncoveredLinesColHeader")}],N.nls.localize("codeCovHeader"))}formatUncoveredLines(e){if(0===e.length)return"";let t=e.length>5?5:e.length,r=e.slice(0,t).join(",");return e.length>5&&(r+="..."),r}};eo.HumanReporter=HumanReporter;var ea={},ec={exports:{}};const{promisify:el}=T,eu=(0,C.gte_1)(process.version,"10.12.0"),eh=e=>{if("win32"===process.platform&&/[<>:"|?*]/.test(e.replace(E.parse(e).root,""))){let t=Error(`Path contains invalid characters: ${e}`);throw t.code="EINVAL",t}},ed=e=>({mode:511,fs:b,...e}),ep=e=>{let t=Error(`operation not permitted, mkdir '${e}'`);return t.code="EPERM",t.errno=-4048,t.path=e,t.syscall="mkdir",t},em=async(e,t)=>{eh(e);let r=el((t=ed(t)).fs.mkdir),s=el(t.fs.stat);if(eu&&t.fs.mkdir===b.mkdir){let s=E.resolve(e);return await r(s,{mode:t.mode,recursive:!0}),s}let n=async e=>{try{return await r(e,t.mode),e}catch(t){if("EPERM"===t.code)throw t;if("ENOENT"===t.code){if(E.dirname(e)===e)throw ep(e);if(t.message.includes("null bytes"))throw t;return await n(E.dirname(e)),n(e)}try{if(!(await s(e)).isDirectory())throw Error("The path is not a directory")}catch{throw t}return e}};return n(E.resolve(e))};ec.exports=em,ec.exports.sync=(e,t)=>{if(eh(e),t=ed(t),eu&&t.fs.mkdirSync===b.mkdirSync){let r=E.resolve(e);return b.mkdirSync(r,{mode:t.mode,recursive:!0}),r}let r=e=>{try{t.fs.mkdirSync(e,t.mode)}catch(s){if("EPERM"===s.code)throw s;if("ENOENT"===s.code){if(E.dirname(e)===e)throw ep(e);if(s.message.includes("null bytes"))throw s;return r(E.dirname(e)),r(e)}try{if(!t.fs.statSync(e).isDirectory())throw Error("The path is not a directory")}catch{throw s}}return e};return r(E.resolve(e))};var ef=ec.exports;const eg=(e,t=process.argv)=>{let r=e.startsWith("-")?"":1===e.length?"-":"--",s=t.indexOf(r+e),n=t.indexOf("--");return -1!==s&&(-1===n||s<n)},{env:ev}=process;function ey(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function eb(t,r){if(0===e)return 0;if(eg("color=16m")||eg("color=full")||eg("color=truecolor"))return 3;if(eg("color=256"))return 2;if(t&&!r&&void 0===e)return 0;let s=e||0;if("dumb"===ev.TERM)return s;if("win32"===process.platform){let e=S.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in ev)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(e=>e in ev)||"codeship"===ev.CI_NAME?1:s;if("TEAMCITY_VERSION"in ev)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ev.TEAMCITY_VERSION)?1:0;if("truecolor"===ev.COLORTERM)return 3;if("TERM_PROGRAM"in ev){let e=parseInt((ev.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ev.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ev.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ev.TERM)||"COLORTERM"in ev?1:s}eg("no-color")||eg("no-colors")||eg("color=false")||eg("color=never")?e=0:(eg("color")||eg("colors")||eg("color=true")||eg("color=always"))&&(e=1),"FORCE_COLOR"in ev&&(e="true"===ev.FORCE_COLOR?1:"false"===ev.FORCE_COLOR?0:0===ev.FORCE_COLOR.length?1:Math.min(parseInt(ev.FORCE_COLOR,10),3));var eT={supportsColor:function(e){return ey(eb(e,e&&e.isTTY))},stdout:ey(eb(!0,_.isatty(1))),stderr:ey(eb(!0,_.isatty(2)))};let ContentWriter=class ContentWriter{colorize(e){return e}println(e){this.write(`${e}
`)}close(){}};let FileContentWriter=class FileContentWriter extends ContentWriter{constructor(e){super(),this.fd=e}write(e){b.writeSync(this.fd,e)}close(){b.closeSync(this.fd)}};let eE=!1,eR="";let ConsoleWriter=class ConsoleWriter extends ContentWriter{write(e){eE?eR+=e:process.stdout.write(e)}colorize(e,t){let r={low:"31;1",medium:"33;1",high:"32;1"};return eT.stdout&&r[t]?`\u001b[${r[t]}m${e}\u001b[0m`:e}};let eC=class FileWriter{constructor(e){if(!e)throw Error("baseDir must be specified");this.baseDir=e}static startCapture(){eE=!0}static stopCapture(){eE=!1}static getOutput(){return eR}static resetOutput(){eR=""}writerForDir(e){if(E.isAbsolute(e))throw Error(`Cannot create subdir writer for absolute path: ${e}`);return new FileWriter(`${this.baseDir}/${e}`)}copyFile(e,t,r){let s;if(E.isAbsolute(t))throw Error(`Cannot write to absolute path: ${t}`);t=E.resolve(this.baseDir,t),ef.sync(E.dirname(t)),s=r?r+b.readFileSync(e,"utf8"):b.readFileSync(e),b.writeFileSync(t,s)}writeFile(e){if(null===e||"-"===e)return new ConsoleWriter;if(E.isAbsolute(e))throw Error(`Cannot write to absolute path: ${e}`);return e=E.resolve(this.baseDir,e),ef.sync(E.dirname(e)),new FileContentWriter(b.openSync(e,"w"))}};function eS(e){return Object.entries(e||{}).map(([e,t])=>` ${e}="${t}"`).join("")}let e_=class{constructor(e){this.cw=e,this.stack=[]}indent(e){return this.stack.map(()=>"  ").join("")+e}openTag(e,t){let r=this.indent(`<${e+eS(t)}>`);this.cw.println(r),this.stack.push(e)}closeTag(e){if(0===this.stack.length)throw Error(`Attempt to close tag ${e} when not opened`);let t=this.stack.pop(),r=`</${e}>`;if(t!==e)throw Error(`Attempt to close tag ${e} when ${t} was the one open`);this.cw.println(this.indent(r))}inlineTag(e,t,r){let s="<"+e+eS(t);r?s+=`>${r}</${e}>`:s+="/>",s=this.indent(s),this.cw.println(s)}closeAll(){this.stack.slice().reverse().forEach(e=>{this.closeTag(e)})}};let Visitor=class Visitor{constructor(e){this.delegate=e}};["Start","End","Summary","SummaryEnd","Detail"].map(e=>`on${e}`).forEach(e=>{Object.defineProperty(Visitor.prototype,e,{writable:!0,value(t,r){"function"==typeof this.delegate[e]&&this.delegate[e](t,r)}})});let CompositeVisitor=class CompositeVisitor extends Visitor{constructor(e){super(),Array.isArray(e)||(e=[e]),this.visitors=e.map(e=>e instanceof Visitor?e:new Visitor(e))}};["Start","Summary","SummaryEnd","Detail","End"].map(e=>`on${e}`).forEach(e=>{Object.defineProperty(CompositeVisitor.prototype,e,{value(t,r){this.visitors.forEach(s=>{s[e](t,r)})}})});let eO=class{isRoot(){return!this.getParent()}visit(e,t){this.isSummary()?e.onSummary(this,t):e.onDetail(this,t),this.getChildren().forEach(r=>{r.visit(e,t)}),this.isSummary()&&e.onSummaryEnd(this,t)}};var ew={BaseTree:class{constructor(e){this.root=e}getRoot(){return this.root}visit(e,t){e instanceof Visitor||(e=new Visitor(e)),e.onStart(this.getRoot(),t),this.getRoot().visit(e,t),e.onEnd(this.getRoot(),t)}},BaseNode:eO,Visitor,CompositeVisitor},ex=()=>({statements:[50,80],functions:[50,80],branches:[50,80],lines:[50,80]}),eI={exports:{}},eA=function(e,t){return t>0?Math.floor(1e5*e/t/10)/100:100},eL=function(e,t){t.forEach(t=>{Object.defineProperty(e.prototype,t,{enumerable:!0,get(){return this.data[t]}})})};let ek=class CoverageSummary{constructor(e){e?e instanceof CoverageSummary?this.data=e.data:this.data=e:this.data=function(){let e=()=>({total:0,covered:0,skipped:0,pct:"Unknown"});return{lines:e(),statements:e(),functions:e(),branches:e(),branchesTrue:e()}}(),function(e){if(!(e&&e.lines&&e.statements&&e.functions&&e.branches))throw Error("Invalid summary coverage object, missing keys, found:"+Object.keys(e).join(","))}(this.data)}merge(e){return["lines","statements","branches","functions","branchesTrue"].forEach(t=>{e[t]&&(this[t].total+=e[t].total,this[t].covered+=e[t].covered,this[t].skipped+=e[t].skipped,this[t].pct=eA(this[t].covered,this[t].total))}),this}toJSON(){return this.data}isEmpty(){return 0===this.lines.total}};eL(ek,["lines","statements","functions","branches","branchesTrue"]);var eP={CoverageSummary:ek};const{CoverageSummary:ej}=eP,eN=({start:e,end:t})=>`${e.line}|${e.column}|${t.line}|${t.column}`,eM=e=>!!e&&"object"==typeof e,eD=e=>eM(e)&&"number"==typeof e.line&&"number"==typeof e.column,eF=e=>eM(e)&&eD(e.start)&&eD(e.end),e$=e=>eF(e)?e:eF(e.loc)?e.loc:null,eU=(e,t)=>{let r=e$(e);if(!r)return null;let s=null,n=null,i=null;for(let[e,o]of Object.entries(t)){let t=e$(o);if(!t)continue;let a=[r.start.line-t.start.line,r.start.column-t.start.column,t.end.line-r.end.line,t.end.column-r.end.column];if(a[0]<0||a[2]<0||0===a[0]&&a[1]<0||0===a[2]&&a[3]<0)continue;if(null===s){n=a,s=o,i=e;continue}let c=a[0]<n[0]||0===a[0]&&a[1]<n[1],l=a[2]<n[2]||0===a[2]&&a[3]<n[3];(c||l)&&(n=a,s=o,i=e)}return i},ez=(e,t)=>"number"==typeof e&&"number"==typeof t?e+t:Array.isArray(e)&&Array.isArray(t)?e.map((e,r)=>(e||0)+(t[r]||0)):null,eG=(e,t,r,s)=>{let n=eU(e,r);return n?ez(t,s[n]):t},eH=(e,t,r,s,n=eN)=>{let i={};for(let[r,s]of Object.entries(e)){let e=t[r];i[n(e)]=[s,e]}let o={};for(let[e,t]of Object.entries(r)){let r=s[e];o[n(r)]=[t,r]}let a={};for(let[e,t]of Object.entries(i)){let n=t[0],i=t[1],c=o[e];n=c?ez(n,c[0]):eG(i,n,s,r),a[e]=[n,i]}for(let[r,s]of Object.entries(o)){let n=s[0],i=s[1];a[r]||(n=eG(i,n,t,e),a[r]=[n,i])}let c={},l={};return Object.values(a).forEach(([e,t],r)=>{c[r]=e,l[r]=t}),[c,l]};let eq=class FileCoverage{constructor(e,t=!1){if(!e)throw Error("Coverage must be initialized with a path or an object");if("string"==typeof e)this.data=function(e,t){let r={path:e,statementMap:{},fnMap:{},branchMap:{},s:{},f:{},b:{}};return t&&(r.bT={}),r}(e,t);else if(e instanceof FileCoverage)this.data=e.data;else if("object"==typeof e)this.data=e;else throw Error("Invalid argument to coverage constructor");!function(e){if(!(e&&e.path&&e.statementMap&&e.fnMap&&e.branchMap&&e.s&&e.f&&e.b))throw Error("Invalid file coverage object, missing keys, found:"+Object.keys(e).join(","))}(this.data)}getLineCoverage(){let e=this.data.statementMap,t=this.data.s,r=Object.create(null);return Object.entries(t).forEach(([t,s])=>{if(!e[t])return;let{line:n}=e[t].start,i=r[n];(void 0===i||i<s)&&(r[n]=s)}),r}getUncoveredLines(){let e=this.getLineCoverage(),t=[];return Object.entries(e).forEach(([e,r])=>{0===r&&t.push(e)}),t}getBranchCoverageByLine(){let e=this.branchMap,t=this.b,r={};return Object.entries(e).forEach(([e,s])=>{let n=s.line||s.loc.start.line,i=t[e];r[n]=r[n]||[],r[n].push(...i)}),Object.entries(r).forEach(([e,t])=>{let s=t.filter(e=>e>0),n=s.length/t.length*100;r[e]={covered:s.length,total:t.length,coverage:n}}),r}toJSON(){return this.data}merge(e){if(!0===e.all)return;if(!0===this.all){this.data=e.data;return}let[t,r]=eH(this.s,this.statementMap,e.s,e.statementMap);this.data.s=t,this.data.statementMap=r;let s=e=>eN(e.locations[0]);[t,r]=eH(this.f,this.fnMap,e.f,e.fnMap,e=>eN(e.loc)),this.data.f=t,this.data.fnMap=r,[t,r]=eH(this.b,this.branchMap,e.b,e.branchMap,s),this.data.b=t,this.data.branchMap=r,this.bT&&e.bT&&([t,r]=eH(this.bT,this.branchMap,e.bT,e.branchMap,s),this.data.bT=t)}computeSimpleTotals(e){let t=this[e];"function"==typeof t&&(t=t.call(this));let r={total:Object.keys(t).length,covered:Object.values(t).filter(e=>!!e).length,skipped:0};return r.pct=eA(r.covered,r.total),r}computeBranchTotals(e){let t=this[e],r={total:0,covered:0,skipped:0};return Object.values(t).forEach(e=>{r.covered+=e.filter(e=>e>0).length,r.total+=e.length}),r.pct=eA(r.covered,r.total),r}resetHits(){let e=this.s,t=this.f,r=this.b,s=this.bT;Object.keys(e).forEach(t=>{e[t]=0}),Object.keys(t).forEach(e=>{t[e]=0}),Object.keys(r).forEach(e=>{r[e].fill(0)}),s&&Object.keys(s).forEach(e=>{s[e].fill(0)})}toSummary(){let e={};return e.lines=this.computeSimpleTotals("getLineCoverage"),e.functions=this.computeSimpleTotals("f","fnMap"),e.statements=this.computeSimpleTotals("s","statementMap"),e.branches=this.computeBranchTotals("b"),this.bT&&(e.branchesTrue=this.computeBranchTotals("bT")),new ej(e)}};eL(eq,["path","statementMap","fnMap","branchMap","s","f","b","bT","all"]);var eW={FileCoverage:eq,findNearestContainer:eU,addHits:ez,addNearestContainerHits:eG};const{FileCoverage:eB}=eW,{CoverageSummary:eV}=eP;function eQ(e,t){return e instanceof t?e:new t(e)}let eJ=class CoverageMap{constructor(e){e instanceof CoverageMap?this.data=e.data:this.data=function(e){let t=Object.create(null);return e&&Object.entries(e).forEach(([e,r])=>{t[e]=eQ(r,eB)}),t}(e)}merge(e){Object.values(eQ(e,CoverageMap).data).forEach(e=>{this.addFileCoverage(e)})}filter(e){Object.keys(this.data).forEach(t=>{e(t)||delete this.data[t]})}toJSON(){return this.data}files(){return Object.keys(this.data)}fileCoverageFor(e){let t=this.data[e];if(!t)throw Error(`No file coverage available for: ${e}`);return t}addFileCoverage(e){let t=new eB(e),{path:r}=t;this.data[r]?this.data[r].merge(t):this.data[r]=t}getCoverageSummary(){let e=new eV;return Object.values(this.data).forEach(t=>{e.merge(t.toSummary())}),e}};const{FileCoverage:eY}=eW,{CoverageMap:eX}={CoverageMap:eJ},{CoverageSummary:eK}=eP;eI.exports={createCoverageSummary:e=>e&&e instanceof eK?e:new eK(e),createCoverageMap:e=>e&&e instanceof eX?e:new eX(e),createFileCoverage:e=>e&&e instanceof eY?e:new eY(e)},eI.exports.classes={FileCoverage:eY};var eZ=eI.exports;let e0=E.parse,e1=E.sep;const e2=e0,e3=e1;let e5=class Path{constructor(e){if(Array.isArray(e))this.v=e;else if("string"==typeof e)this.v=function(e,t){let r,s,n;let i=e0(e),o=i.root,a=i.base;return("\\"===t&&(n=o.indexOf(":\\"))>=0&&(o=o.substring(0,n+2)),r=i.dir.substring(o.length),""===e)?[]:("/"!==t&&(s=RegExp(t.replace(/\W/g,"\\$&"),"g"),r=r.replace(s,"/"),a=a.replace(s,"/")),"/"===(r=""!==r?`${r}/${a}`:a).substring(0,1)&&(r=r.substring(1)),r=r.split(/\/+/))}(e,e1);else throw Error(`Invalid Path argument must be string or array:${e}`)}toString(){return this.v.join("/")}hasParent(){return this.v.length>0}parent(){if(!this.hasParent())throw Error("Unable to get parent for 0 elem path");let e=this.v.slice();return e.pop(),new Path(e)}elements(){return this.v.slice()}name(){return this.v.slice(-1)[0]}contains(e){let t;if(e.length>this.length)return!1;for(t=0;t<e.length;t+=1)if(this.v[t]!==e.v[t])return!1;return!0}ancestorOf(e){return e.contains(this)&&e.length!==this.length}descendantOf(e){return this.contains(e)&&e.length!==this.length}commonPrefixPath(e){let t;let r=this.length>e.length?e.length:this.length,s=[];for(t=0;t<r;t+=1)if(this.v[t]===e.v[t])s.push(this.v[t]);else break;return new Path(s)}static compare(e,t){let r=e.length,s=t.length;if(r<s)return -1;if(r>s)return 1;let n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0}};["push","pop","shift","unshift","splice"].forEach(e=>{Object.defineProperty(e5.prototype,e,{value(...t){return this.v[e](...t)}})}),Object.defineProperty(e5.prototype,"length",{enumerable:!0,get(){return this.v.length}}),e5.tester={setParserAndSep(e,t){e0=e,e1=t},reset(){e0=e2,e1=e3}};const{BaseNode:e8,BaseTree:e6}=ew;let ReportNode=class ReportNode extends e8{constructor(e,t){super(),this.path=e,this.parent=null,this.fileCoverage=t,this.children=[]}static createRoot(e){let t=new ReportNode(new e5([]));return e.forEach(e=>{t.addChild(e)}),t}addChild(e){e.parent=this,this.children.push(e)}asRelative(e){return"/"===e.substring(0,1)?e.substring(1):e}getQualifiedName(){return this.asRelative(this.path.toString())}getRelativeName(){let e,t;let r=this.getParent(),s=this.path,n=r?r.path:new e5([]);if(n.ancestorOf(s)){for(t=0,e=new e5(s.elements());t<n.length;t+=1)e.shift();return this.asRelative(e.toString())}return this.asRelative(this.path.toString())}getParent(){return this.parent}getChildren(){return this.children}isSummary(){return!this.fileCoverage}getFileCoverage(){return this.fileCoverage}getCoverageSummary(e){let t;let r=`c_${e?"files":"full"}`;if(Object.prototype.hasOwnProperty.call(this,r))return this[r];if(this.isSummary()){let r=0;t=eZ.createCoverageSummary(),this.getChildren().forEach(s=>{e&&s.isSummary()||(r+=1,t.merge(s.getCoverageSummary(e)))}),0===r&&e&&(t=null)}else t=this.getFileCoverage().toSummary();return this[r]=t,t}};let ReportTree=class ReportTree extends e6{constructor(e,t){super(e);let r=e=>{t&&!e.isRoot()&&e.path.unshift(t)};this.visit({onDetail:r,onSummary(e){r(e),e.children.sort((e,t)=>{let r=e.path.toString(),s=t.path.toString();return r<s?-1:r>s?1:0})}})}};function e4(e,t,r=()=>{}){let s=t[e.toString()];return s||(s=new ReportNode(e),t[e.toString()]=s,r(e,s)),s}let e7=class{constructor(e,t="pkg"){var r;this._coverageMap=e,this._defaultSummarizer=t,this._initialList=e.files().map(t=>({filePath:t,path:new e5(t),fileCoverage:e.fileCoverageFor(t)})),this._commonParent=(r=this._initialList.map(e=>e.path.parent())).reduce((e,t)=>e.commonPrefixPath(t),r[0]||new e5([])),this._commonParent.length>0&&this._initialList.forEach(e=>{e.path.splice(0,this._commonParent.length)})}get defaultSummarizer(){return this[this._defaultSummarizer]}get flat(){return this._flat||(this._flat=new ReportTree(ReportNode.createRoot(this._initialList.map(e=>new ReportNode(e.path,e.fileCoverage))))),this._flat}_createPkg(){var e;let t=function(e){let t=Object.create(null);return e.forEach(e=>{e4(e.path.parent(),t).addChild(new ReportNode(e.path,e.fileCoverage))}),Object.values(t)}(this._initialList);return 1===t.length?new ReportTree(t[0]):new ReportTree(ReportNode.createRoot(t),(e=this._commonParent,t.some(e=>0===e.path.length)?0===e.length?"root":e.name():void 0))}get pkg(){return this._pkg||(this._pkg=this._createPkg()),this._pkg}_createNested(){let e=Object.create(null),t=[];this._initialList.forEach(r=>{let s=new ReportNode(r.path,r.fileCoverage);!function e(t,r,s,n){e4(s.parent(),r,(s,n)=>{s.hasParent()?e(t,r,s,n):t.push(n)}).addChild(n)}(t,e,r.path,s)});let r=t.map(e=>(function e(t,r){let{children:s}=t;return 1!==s.length||s[0].fileCoverage?(t.children=s.map(r=>e(r,t)),t):(s[0].parent=r,e(s[0],r))})(e));return new ReportTree(1===r.length?r[0]:ReportNode.createRoot(r))}get nested(){return this._nested||(this._nested=this._createNested()),this._nested}};function e9(e){try{return b.readFileSync(e,"utf8")}catch(t){throw Error(`Unable to lookup source: ${e} (${t.message})`)}}let te=class{constructor(e){this.dir=e.dir||"coverage",this.watermarks=function(e={}){return Object.entries(ex()).forEach(([t,r])=>{let s=e[t];Array.isArray(s)&&2===s.length||(e[t]=r)}),e}(e.watermarks),this.sourceFinder=e.sourceFinder||e9,this._summarizerFactory=new e7(e.coverageMap,e.defaultSummarizer),this.data={}}getWriter(){return this.writer}getSource(e){return this.sourceFinder(e)}classForPercent(e,t){let r=this.watermarks[e];return r?t<r[0]?"low":t>=r[1]?"high":"medium":"unknown"}getXMLWriter(e){return new e_(e)}getVisitor(e){return new ew.Visitor(e)}getTree(e="defaultSummarizer"){return this._summarizerFactory[e]}};Object.defineProperty(te.prototype,"writer",{enumerable:!0,get(){return this.data.writer||(this.data.writer=new eC(this.dir)),this.data.writer}});const tt=Symbol("ReportBase.#summarizer");var tr={createContext:e=>new te(e)},ts={create(e,t){let r;t=t||{};try{r=C.commonjsRequire(E.join(__dirname,"lib",e))}catch(t){if("MODULE_NOT_FOUND"!==t.code)throw t;r=C.commonjsRequire(e)}return new r(t)}},tn={},ti="win32"===process.platform,to=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);if(E.normalize,ti)var ta=/(.*?)(?:[\/\\]+|$)/g;else var ta=/(.*?)(?:[\/]+|$)/g;if(ti)var tc=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else var tc=/^[\/]*/;tn.realpathSync=function(e,t){if(e=E.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r=e,s={},n={};function i(){var t=tc.exec(e);o=t[0].length,a=t[0],c=t[0],l="",ti&&!n[c]&&(b.lstatSync(c),n[c]=!0)}for(i();o<e.length;){ta.lastIndex=o;var o,a,c,l,u,h=ta.exec(e);if(l=a,a+=h[0],c=l+h[1],o=ta.lastIndex,!n[c]&&(!t||t[c]!==c)){if(t&&Object.prototype.hasOwnProperty.call(t,c))u=t[c];else{var d=b.lstatSync(c);if(!d.isSymbolicLink()){n[c]=!0,t&&(t[c]=c);continue}var p=null;if(!ti){var m=d.dev.toString(32)+":"+d.ino.toString(32);s.hasOwnProperty(m)&&(p=s[m])}null===p&&(b.statSync(c),p=b.readlinkSync(c)),u=E.resolve(l,p),t&&(t[c]=u),ti||(s[m]=p)}e=E.resolve(u,e.slice(o)),i()}}return t&&(t[r]=e),e},tn.realpath=function(e,t,r){if("function"!=typeof r){var s;r="function"==typeof(s=t)?s:function(){var e;if(to){var t=Error();e=function(e){e&&(t.message=e.message,r(e=t))}}else e=r;return e;function r(e){if(e){if(process.throwDeprecation)throw e;if(!process.noDeprecation){var t="fs: missing callback "+(e.stack||e.message);process.traceDeprecation?console.trace(t):console.error(t)}}}}(),t=null}if(e=E.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var n,i,o,a,c=e,l={},u={};function h(){var t=tc.exec(e);n=t[0].length,i=t[0],o=t[0],a="",ti&&!u[o]?b.lstat(o,function(e){if(e)return r(e);u[o]=!0,d()}):process.nextTick(d)}function d(){if(n>=e.length)return t&&(t[c]=e),r(null,e);ta.lastIndex=n;var s=ta.exec(e);return(a=i,i+=s[0],o=a+s[1],n=ta.lastIndex,u[o]||t&&t[o]===o)?process.nextTick(d):t&&Object.prototype.hasOwnProperty.call(t,o)?f(t[o]):b.lstat(o,p)}function p(e,s){if(e)return r(e);if(!s.isSymbolicLink())return u[o]=!0,t&&(t[o]=o),process.nextTick(d);if(!ti){var n=s.dev.toString(32)+":"+s.ino.toString(32);if(l.hasOwnProperty(n))return m(null,l[n],o)}b.stat(o,function(e){if(e)return r(e);b.readlink(o,function(e,t){ti||(l[n]=t),m(e,t)})})}function m(e,s,n){if(e)return r(e);var i=E.resolve(a,s);t&&(t[n]=i),f(i)}function f(t){e=E.resolve(t,e.slice(n)),h()}h()},tm.realpath=tm,tm.sync=tf,tm.realpathSync=tf,tm.monkeypatch=function(){b.realpath=tm,b.realpathSync=tf},tm.unmonkeypatch=function(){b.realpath=tl,b.realpathSync=tu};var tl=b.realpath,tu=b.realpathSync,th=process.version,td=/^v[0-5]\./.test(th);function tp(e){return e&&"realpath"===e.syscall&&("ELOOP"===e.code||"ENOMEM"===e.code||"ENAMETOOLONG"===e.code)}function tm(e,t,r){if(td)return tl(e,t,r);"function"==typeof t&&(r=t,t=null),tl(e,t,function(s,n){tp(s)?tn.realpath(e,t,r):r(s,n)})}function tf(e,t){if(td)return tu(e,t);try{return tu(e,t)}catch(r){if(tp(r))return tn.realpathSync(e,t);throw r}}const tg="object"==typeof process&&process&&"win32"===process.platform;var tv=C.balancedMatch,ty="\0SLASH"+Math.random()+"\0",tb="\0OPEN"+Math.random()+"\0",tT="\0CLOSE"+Math.random()+"\0",tE="\0COMMA"+Math.random()+"\0",tR="\0PERIOD"+Math.random()+"\0";function tC(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function tS(e){return e.split(ty).join("\\").split(tb).join("{").split(tT).join("}").split(tE).join(",").split(tR).join(".")}function t_(e){return"{"+e+"}"}function tO(e){return/^-?0\d/.test(e)}function tw(e,t){return e<=t}function tx(e,t){return e>=t}const tI=tA=(e,t,r={})=>(tG(t),(!!r.nocomment||"#"!==t.charAt(0))&&new tQ(t,r).match(e));var tA=tI;const tL=tg?{sep:"\\"}:{sep:"/"};tI.sep=tL.sep;const tk=Symbol("globstar **");tI.GLOBSTAR=tk;const tP={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},tj="[^/]",tN=tj+"*?",tM=e=>e.split("").reduce((e,t)=>(e[t]=!0,e),{}),tD=tM("().*{}+?[]^$\\!"),tF=tM("[.("),t$=/\/+/;tI.filter=(e,t={})=>(r,s,n)=>tI(r,e,t);const tU=(e,t={})=>{let r={};return Object.keys(e).forEach(t=>r[t]=e[t]),Object.keys(t).forEach(e=>r[e]=t[e]),r};tI.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return tI;let t=tI,r=(r,s,n)=>t(r,s,tU(e,n));return r.Minimatch=class extends t.Minimatch{constructor(t,r){super(t,tU(e,r))}},r.Minimatch.defaults=r=>t.defaults(tU(e,r)).Minimatch,r.filter=(r,s)=>t.filter(r,tU(e,s)),r.defaults=r=>t.defaults(tU(e,r)),r.makeRe=(r,s)=>t.makeRe(r,tU(e,s)),r.braceExpand=(r,s)=>t.braceExpand(r,tU(e,s)),r.match=(r,s,n)=>t.match(r,s,tU(e,n)),r},tI.braceExpand=(e,t)=>tz(e,t);const tz=(e,t={})=>{var r;return(tG(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e))?[e]:(r=e)?("{}"===r.substr(0,2)&&(r="\\{\\}"+r.substr(2)),(function e(t,r){var s=[],n=tv("{","}",t);if(!n)return[t];var i=n.pre,o=n.post.length?e(n.post,!1):[""];if(/\$$/.test(n.pre))for(var a=0;a<o.length;a++){var c=i+"{"+n.body+"}"+o[a];s.push(c)}else{var l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),h=l||u,d=n.body.indexOf(",")>=0;if(!h&&!d)return n.post.match(/,.*\}/)?e(t=n.pre+"{"+n.body+tT+n.post):[t];if(h)p=n.body.split(/\.\./);else if(1===(p=function e(t){if(!t)return[""];var r=[],s=tv("{","}",t);if(!s)return t.split(",");var n=s.pre,i=s.body,o=s.post,a=n.split(",");a[a.length-1]+="{"+i+"}";var c=e(o);return o.length&&(a[a.length-1]+=c.shift(),a.push.apply(a,c)),r.push.apply(r,a),r}(n.body)).length&&1===(p=e(p[0],!1).map(t_)).length)return o.map(function(e){return n.pre+p[0]+e});if(h){var p,m,f,g=tC(p[0]),v=tC(p[1]),y=Math.max(p[0].length,p[1].length),b=3==p.length?Math.abs(tC(p[2])):1,T=tw;v<g&&(b*=-1,T=tx);var E=p.some(tO);m=[];for(var R=g;T(R,v);R+=b){if(u)"\\"===(f=String.fromCharCode(R))&&(f="");else if(f=String(R),E){var C=y-f.length;if(C>0){var S=Array(C+1).join("0");f=R<0?"-"+S+f.slice(1):S+f}}m.push(f)}}else{m=[];for(var _=0;_<p.length;_++)m.push.apply(m,e(p[_],!1))}for(var _=0;_<m.length;_++)for(var a=0;a<o.length;a++){var c=i+m[_]+o[a];(!r||h||c)&&s.push(c)}}return s})(r.split("\\\\").join(ty).split("\\{").join(tb).split("\\}").join(tT).split("\\,").join(tE).split("\\.").join(tR),!0).map(tS)):[]},tG=e=>{if("string"!=typeof e)throw TypeError("invalid pattern");if(e.length>65536)throw TypeError("pattern is too long")},tH=Symbol("subparse");tI.makeRe=(e,t)=>new tQ(e,t||{}).makeRe(),tI.match=(e,t,r={})=>{let s=new tQ(t,r);return e=e.filter(e=>s.match(e)),s.options.nonull&&!e.length&&e.push(t),e};const tq=e=>e.replace(/\\(.)/g,"$1"),tW=e=>e.replace(/\\([^-\]])/g,"$1"),tB=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),tV=e=>e.replace(/[[\]\\]/g,"\\$&");let tQ=class{constructor(e,t){tG(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||!1===t.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0)){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let r=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,r),r=this.globParts=r.map(e=>e.split(t$)),this.debug(this.pattern,r),r=r.map((e,t,r)=>e.map(this.parse,this)),this.debug(this.pattern,r),r=r.filter(e=>-1===e.indexOf(!1)),this.debug(this.pattern,r),this.set=r}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,r=0;for(let s=0;s<e.length&&"!"===e.charAt(s);s++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t,r){var s=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var n=0,i=0,o=e.length,a=t.length;n<o&&i<a;n++,i++){this.debug("matchOne loop");var c,l=t[i],u=e[n];if(this.debug(t,l,u),!1===l)return!1;if(l===tk){this.debug("GLOBSTAR",[t,l,u]);var h=n,d=i+1;if(d===a){for(this.debug("** at the end");n<o;n++)if("."===e[n]||".."===e[n]||!s.dot&&"."===e[n].charAt(0))return!1;return!0}for(;h<o;){var p=e[h];if(this.debug("\nglobstar while",e,h,t,d,p),this.matchOne(e.slice(h),t.slice(d),r))return this.debug("globstar found match!",h,o,p),!0;if("."===p||".."===p||!s.dot&&"."===p.charAt(0)){this.debug("dot detected!",e,h,t,d);break}this.debug("globstar swallow a segment, and continue"),h++}if(r&&(this.debug("\n>>> no match, partial?",e,h,t,d),h===o))return!0;return!1}if("string"==typeof l?(c=u===l,this.debug("string match",l,u,c)):(c=u.match(l),this.debug("pattern match",l,u,c)),!c)return!1}if(n===o&&i===a)return!0;if(n===o)return r;if(i===a)return n===o-1&&""===e[n];throw Error("wtf?")}braceExpand(){return tz(this.pattern,this.options)}parse(e,t){let r,s,n,i;tG(e);let o=this.options;if("**"===e){if(!o.noglobstar)return tk;e="*"}if(""===e)return"";let a="",c=!1,l=!1,u=[],h=[],d=!1,p=-1,m=-1,f="."===e.charAt(0),g=o.dot||f,v=e=>"."===e.charAt(0)?"":o.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",y=()=>{if(r){switch(r){case"*":a+=tN,c=!0;break;case"?":a+=tj,c=!0;break;default:a+="\\"+r}this.debug("clearStateChar %j %j",r,a),r=!1}};for(let t=0,i;t<e.length&&(i=e.charAt(t));t++){if(this.debug("%s	%s %s %j",e,t,a,i),l){if("/"===i)return!1;tD[i]&&(a+="\\"),a+=i,l=!1;continue}switch(i){case"/":return!1;case"\\":if(d&&"-"===e.charAt(t+1)){a+=i;continue}y(),l=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,t,a,i),d){this.debug("  in class"),"!"===i&&t===m+1&&(i="^"),a+=i;continue}this.debug("call clearStateChar %j",r),y(),r=i,o.noext&&y();continue;case"(":{if(d){a+="(";continue}if(!r){a+="\\(";continue}let s={type:r,start:t-1,reStart:a.length,open:tP[r].open,close:tP[r].close};this.debug(this.pattern,"	",s),u.push(s),a+=s.open,0===s.start&&"!"!==s.type&&(f=!0,a+=v(e.slice(t+1))),this.debug("plType %j %j",r,a),r=!1;continue}case")":{let e=u[u.length-1];if(d||!e){a+="\\)";continue}u.pop(),y(),c=!0,a+=(n=e).close,"!"===n.type&&h.push(Object.assign(n,{reEnd:a.length}));continue}case"|":{let r=u[u.length-1];if(d||!r){a+="\\|";continue}y(),a+="|",0===r.start&&"!"!==r.type&&(f=!0,a+=v(e.slice(t+1)));continue}case"[":if(y(),d){a+="\\"+i;continue}d=!0,m=t,p=a.length,a+=i;continue;case"]":if(t===m+1||!d){a+="\\"+i;continue}s=e.substring(m+1,t);try{RegExp("["+tV(tW(s))+"]"),a+=i}catch(e){a=a.substring(0,p)+"(?:$.)"}c=!0,d=!1;continue;default:y(),tD[i]&&!("^"===i&&d)&&(a+="\\"),a+=i}}for(d&&(s=e.slice(m+1),i=this.parse(s,tH),a=a.substring(0,p)+"\\["+i[0],c=c||i[1]),n=u.pop();n;n=u.pop()){let e;e=a.slice(n.reStart+n.open.length),this.debug("setting tail",a,n),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,(e,t,r)=>(r||(r="\\"),t+t+r+"|")),this.debug("tail=%j\n   %s",e,e,n,a);let t="*"===n.type?tN:"?"===n.type?tj:"\\"+n.type;c=!0,a=a.slice(0,n.reStart)+t+"\\("+e}y(),l&&(a+="\\\\");let b=tF[a.charAt(0)];for(let e=h.length-1;e>-1;e--){let r=h[e],s=a.slice(0,r.reStart),n=a.slice(r.reStart,r.reEnd-8),i=a.slice(r.reEnd),o=a.slice(r.reEnd-8,r.reEnd)+i,c=s.split(")").length,l=s.split("(").length-c,u=i;for(let e=0;e<l;e++)u=u.replace(/\)[+*?]?/,"");let d=""===(i=u)&&t!==tH?"(?:$|\\/)":"";a=s+n+i+d+o}if(""!==a&&c&&(a="(?=.)"+a),b&&(a=(f?"":g?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)")+a),t===tH)return[a,c];if(o.nocase&&!c&&(c=e.toUpperCase()!==e.toLowerCase()),!c)return tq(e);let T=o.nocase?"i":"";try{return Object.assign(RegExp("^"+a+"$",T),{_glob:e,_src:a})}catch(e){return RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,r=t.noglobstar?tN:t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",s=t.nocase?"i":"",n=e.map(e=>((e=e.map(e=>"string"==typeof e?tB(e):e===tk?tk:e._src).reduce((e,t)=>(e[e.length-1]===tk&&t===tk||e.push(t),e),[])).forEach((t,s)=>{t===tk&&e[s-1]!==tk&&(0===s?e.length>1?e[s+1]="(?:\\/|"+r+"\\/)?"+e[s+1]:e[s]=r:s===e.length-1?e[s-1]+="(?:\\/|"+r+")?":(e[s-1]+="(?:\\/|\\/"+r+"\\/)"+e[s+1],e[s+1]=tk))}),e.filter(e=>e!==tk).join("/"))).join("|");n="^(?:"+n+")$",this.negate&&(n="^(?!"+n+").*$");try{this.regexp=new RegExp(n,s)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){let r;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;let s=this.options;"/"!==tL.sep&&(e=e.split(tL.sep).join("/")),e=e.split(t$),this.debug(this.pattern,"split",e);let n=this.set;this.debug(this.pattern,"set",n);for(let t=e.length-1;t>=0&&!(r=e[t]);t--);for(let i=0;i<n.length;i++){let o=n[i],a=e;if(s.matchBase&&1===o.length&&(a=[r]),this.matchOne(a,o,t)){if(s.flipNegate)return!0;return!this.negate}}return!s.flipNegate&&this.negate}static defaults(e){return tI.defaults(e).Minimatch}};tI.Minimatch=tQ;var tJ={};function tY(e,t){return Object.prototype.hasOwnProperty.call(e,t)}tJ.setopts=function(e,t,r){if(r||(r={}),r.matchBase&&-1===t.indexOf("/")){if(r.noglobstar)throw Error("base matching requires globstar");t="**/"+t}e.windowsPathsNoEscape=!!r.windowsPathsNoEscape||!1===r.allowWindowsEscape,e.windowsPathsNoEscape&&(t=t.replace(/\\/g,"/")),e.silent=!!r.silent,e.pattern=t,e.strict=!1!==r.strict,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0),e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.fs=r.fs||b,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),s=r,e.ignore=s.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]),e.ignore.length&&(e.ignore=e.ignore.map(t1)),e.changedCwd=!1;var s,n=process.cwd();tY(r,"cwd")?(e.cwd=E.resolve(r.cwd),e.changedCwd=e.cwd!==n):e.cwd=E.resolve(n),e.root=r.root||E.resolve(e.cwd,"/"),e.root=E.resolve(e.root),e.cwdAbs=tK(e.cwd)?e.cwd:t2(e,e.cwd),e.nomount=!!r.nomount,"win32"===process.platform&&(e.root=e.root.replace(/\\/g,"/"),e.cwd=e.cwd.replace(/\\/g,"/"),e.cwdAbs=e.cwdAbs.replace(/\\/g,"/")),r.nonegate=!0,r.nocomment=!0,e.minimatch=new tZ(t,r),e.options=e.minimatch.options},tJ.ownProp=tY,tJ.makeAbs=t2,tJ.finish=function(e){for(var t=e.nounique,r=t?[]:Object.create(null),s=0,n=e.matches.length;s<n;s++){var i=e.matches[s];if(i&&0!==Object.keys(i).length){var o=Object.keys(i);t?r.push.apply(r,o):o.forEach(function(e){r[e]=!0})}else if(e.nonull){var a=e.minimatch.globSet[s];t?r.push(a):r[a]=!0}}if(t||(r=Object.keys(r)),e.nosort||(r=r.sort(t0)),e.mark){for(var s=0;s<r.length;s++)r[s]=e._mark(r[s]);e.nodir&&(r=r.filter(function(t){var r=!/\/$/.test(t),s=e.cache[t]||e.cache[t2(e,t)];return r&&s&&(r="DIR"!==s&&!Array.isArray(s)),r}))}e.ignore.length&&(r=r.filter(function(t){return!t3(e,t)})),e.found=r},tJ.mark=function(e,t){var r=t2(e,t),s=e.cache[r],n=t;if(s){var i="DIR"===s||Array.isArray(s),o="/"===t.slice(-1);if(i&&!o?n+="/":!i&&o&&(n=n.slice(0,-1)),n!==t){var a=t2(e,n);e.statCache[a]=e.statCache[r],e.cache[a]=e.cache[r]}}return n},tJ.isIgnored=t3,tJ.childrenIgnored=function(e,t){return!!e.ignore.length&&e.ignore.some(function(e){return!!(e.gmatcher&&e.gmatcher.match(t))})};var tX=tA,tK=E.isAbsolute,tZ=tX.Minimatch;function t0(e,t){return e.localeCompare(t,"en")}function t1(e){var t=null;return"/**"===e.slice(-3)&&(t=new tZ(e.replace(/(\/\*\*)+$/,""),{dot:!0})),{matcher:new tZ(e,{dot:!0}),gmatcher:t}}function t2(e,t){var r=t;return r="/"===t.charAt(0)?E.join(e.root,t):tK(t)||""===t?t:e.changedCwd?E.resolve(e.cwd,t):E.resolve(t),"win32"===process.platform&&(r=r.replace(/\\/g,"/")),r}function t3(e,t){return!!e.ignore.length&&e.ignore.some(function(e){return e.matcher.match(t)||!!(e.gmatcher&&e.gmatcher.match(t))})}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CoverageReporter=e.DefaultReportOptions=e.DefaultWatermarks=void 0;let t=function e(){if(v)return g;v=1,g=d;var t=tA;t.Minimatch;var r=C.inheritsExports,s=O.EventEmitter,n=E.isAbsolute,i=function(){if(f)return m;f=1,m=a,a.GlobSync=c;var t=tA;t.Minimatch,e().Glob;var r=E.isAbsolute,s=tJ.setopts,n=tJ.ownProp,i=tJ.childrenIgnored,o=tJ.isIgnored;function a(e,t){if("function"==typeof t||3==arguments.length)throw TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new c(e,t).found}function c(e,t){if(!e)throw Error("must provide pattern");if("function"==typeof t||3==arguments.length)throw TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof c))return new c(e,t);if(s(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=Array(r);for(var n=0;n<r;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}return c.prototype._finish=function(){if(w.ok(this instanceof c),this.realpath){var e=this;this.matches.forEach(function(t,r){var s=e.matches[r]=Object.create(null);for(var n in t)try{n=e._makeAbs(n),s[tm.realpathSync(n,e.realpathCache)]=!0}catch(t){if("stat"===t.syscall)s[e._makeAbs(n)]=!0;else throw t}})}tJ.finish(this)},c.prototype._process=function(e,s,n){w.ok(this instanceof c);for(var o,a,l=0;"string"==typeof e[l];)l++;switch(l){case e.length:this._processSimple(e.join("/"),s);return;case 0:o=null;break;default:o=e.slice(0,l).join("/")}var u=e.slice(l);null===o?a=".":((r(o)||r(e.map(function(e){return"string"==typeof e?e:"[*]"}).join("/")))&&(!o||!r(o))&&(o="/"+o),a=o);var h=this._makeAbs(a);i(this,a)||(u[0]===t.GLOBSTAR?this._processGlobStar(o,a,h,u,s,n):this._processReaddir(o,a,h,u,s,n))},c.prototype._processReaddir=function(e,t,r,s,n,i){var o=this._readdir(r,i);if(o){for(var a=s[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||"."===l.charAt(0),h=[],d=0;d<o.length;d++){var p=o[d];("."!==p.charAt(0)||u)&&(c&&!e?!p.match(a):p.match(a))&&h.push(p)}var m=h.length;if(0!==m){if(1===s.length&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var d=0;d<m;d++){var p=h[d];e&&(p="/"!==e.slice(-1)?e+"/"+p:e+p),"/"!==p.charAt(0)||this.nomount||(p=E.join(this.root,p)),this._emitMatch(n,p)}return}s.shift();for(var d=0;d<m;d++){var f,p=h[d];f=e?[e,p]:[p],this._process(f.concat(s),n,i)}}}},c.prototype._emitMatch=function(e,t){if(!o(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var s=this.cache[r];if("DIR"===s||Array.isArray(s))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}},c.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);try{r=this.fs.lstatSync(e)}catch(e){if("ENOENT"===e.code)return null}var t,r,s=r&&r.isSymbolicLink();return this.symlinks[e]=s,s||!r||r.isDirectory()?t=this._readdir(e,!1):this.cache[e]="FILE",t},c.prototype._readdir=function(e,t){if(t&&!n(this.symlinks,e))return this._readdirInGlobStar(e);if(n(this.cache,e)){var r=this.cache[e];if(!r||"FILE"===r)return null;if(Array.isArray(r))return r}try{return this._readdirEntries(e,this.fs.readdirSync(e))}catch(t){return this._readdirError(e,t),null}},c.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var s=t[r];s="/"===e?e+s:e+"/"+s,this.cache[s]=!0}return this.cache[e]=t,t},c.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",r===this.cwdAbs){var s=Error(t.code+" invalid cwd "+this.cwd);throw s.path=this.cwd,s.code=t.code,s}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t)}},c.prototype._processGlobStar=function(e,t,r,s,n,i){var o=this._readdir(r,i);if(o){var a=s.slice(1),c=e?[e]:[],l=c.concat(a);this._process(l,n,!1);var u=o.length;if(!this.symlinks[r]||!i){for(var h=0;h<u;h++)if("."!==o[h].charAt(0)||this.dot){var d=c.concat(o[h],a);this._process(d,n,!0);var p=c.concat(o[h],s);this._process(p,n,!0)}}}},c.prototype._processSimple=function(e,t){var s=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),s){if(e&&r(e)&&!this.nomount){var n=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=E.join(this.root,e):(e=E.resolve(this.root,e),n&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}},c.prototype._stat=function(e){var t,r=this._makeAbs(e),s="/"===e.slice(-1);if(e.length>this.maxLength)return!1;if(!this.stat&&n(this.cache,r)){var i=this.cache[r];if(Array.isArray(i)&&(i="DIR"),!s||"DIR"===i)return i;if(s&&"FILE"===i)return!1}var o=this.statCache[r];if(!o){try{t=this.fs.lstatSync(r)}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return this.statCache[r]=!1,!1}if(t&&t.isSymbolicLink())try{o=this.fs.statSync(r)}catch(e){o=t}else o=t}this.statCache[r]=o;var i=!0;return o&&(i=o.isDirectory()?"DIR":"FILE"),this.cache[r]=this.cache[r]||i,(!s||"FILE"!==i)&&i},c.prototype._mark=function(e){return tJ.mark(this,e)},c.prototype._makeAbs=function(e){return tJ.makeAbs(this,e)},m}(),o=tJ.setopts,a=tJ.ownProp,c=C.inflight_1,l=tJ.childrenIgnored,u=tJ.isIgnored,h=C.onceExports;function d(e,t,r){if("function"==typeof t&&(r=t,t={}),t||(t={}),t.sync){if(r)throw TypeError("callback provided to sync glob");return i(e,t)}return new y(e,t,r)}d.sync=i;var p=d.GlobSync=i.GlobSync;function y(e,t,r){if("function"==typeof t&&(r=t,t=null),t&&t.sync){if(r)throw TypeError("callback provided to sync glob");return new p(e,t)}if(!(this instanceof y))return new y(e,t,r);o(this,e,t),this._didRealPath=!1;var s=this.minimatch.set.length;this.matches=Array(s),"function"==typeof r&&(r=h(r),this.on("error",r),this.on("end",function(e){r(null,e)}));var n=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===s)return c();for(var i=!0,a=0;a<s;a++)this._process(this.minimatch.set[a],a,!1,c);function c(){--n._processing,n._processing<=0&&(i?process.nextTick(function(){n._finish()}):n._finish())}i=!1}return d.glob=d,d.hasMagic=function(e,t){var r=function(e,t){if(null===t||"object"!=typeof t)return e;for(var r=Object.keys(t),s=r.length;s--;)e[r[s]]=t[r[s]];return e}({},t);r.noprocess=!0;var s=new y(e,r).minimatch.set;if(!e)return!1;if(s.length>1)return!0;for(var n=0;n<s[0].length;n++)if("string"!=typeof s[0][n])return!0;return!1},d.Glob=y,r(y,s),y.prototype._finish=function(){if(w(this instanceof y),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();tJ.finish(this),this.emit("end",this.found)}},y.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var e=this.matches.length;if(0===e)return this._finish();for(var t=this,r=0;r<this.matches.length;r++)this._realpathSet(r,s)}function s(){0==--e&&t._finish()}},y.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var s=Object.keys(r),n=this,i=s.length;if(0===i)return t();var o=this.matches[e]=Object.create(null);s.forEach(function(r,s){r=n._makeAbs(r),tm.realpath(r,n.realpathCache,function(s,a){s?"stat"===s.syscall?o[r]=!0:n.emit("error",s):o[a]=!0,0==--i&&(n.matches[e]=o,t())})})},y.prototype._mark=function(e){return tJ.mark(this,e)},y.prototype._makeAbs=function(e){return tJ.makeAbs(this,e)},y.prototype.abort=function(){this.aborted=!0,this.emit("abort")},y.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},y.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var s=this._processQueue.slice(0);this._processQueue.length=0;for(var t=0;t<s.length;t++){var n=s[t];this._processing--,this._process(n[0],n[1],n[2],n[3])}}}},y.prototype._process=function(e,r,s,i){if(w(this instanceof y),w("function"==typeof i),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([e,r,s,i]);return}for(var o,a,c=0;"string"==typeof e[c];)c++;switch(c){case e.length:this._processSimple(e.join("/"),r,i);return;case 0:o=null;break;default:o=e.slice(0,c).join("/")}var u=e.slice(c);null===o?a=".":((n(o)||n(e.map(function(e){return"string"==typeof e?e:"[*]"}).join("/")))&&(!o||!n(o))&&(o="/"+o),a=o);var h=this._makeAbs(a);if(l(this,a))return i();u[0]===t.GLOBSTAR?this._processGlobStar(o,a,h,u,r,s,i):this._processReaddir(o,a,h,u,r,s,i)}},y.prototype._processReaddir=function(e,t,r,s,n,i,o){var a=this;this._readdir(r,i,function(c,l){return a._processReaddir2(e,t,r,s,n,i,l,o)})},y.prototype._processReaddir2=function(e,t,r,s,n,i,o,a){if(!o)return a();for(var c=s[0],l=!!this.minimatch.negate,u=c._glob,h=this.dot||"."===u.charAt(0),d=[],p=0;p<o.length;p++){var m=o[p];("."!==m.charAt(0)||h)&&(l&&!e?!m.match(c):m.match(c))&&d.push(m)}var f=d.length;if(0===f)return a();if(1===s.length&&!this.mark&&!this.stat){this.matches[n]||(this.matches[n]=Object.create(null));for(var p=0;p<f;p++){var m=d[p];e&&(m="/"!==e?e+"/"+m:e+m),"/"!==m.charAt(0)||this.nomount||(m=E.join(this.root,m)),this._emitMatch(n,m)}return a()}s.shift();for(var p=0;p<f;p++){var m=d[p];e&&(m="/"!==e?e+"/"+m:e+m),this._process([m].concat(s),n,i,a)}a()},y.prototype._emitMatch=function(e,t){if(!(this.aborted||u(this,t))){if(this.paused){this._emitQueue.push([e,t]);return}var r=n(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var s=this.cache[r];if("DIR"===s||Array.isArray(s))return}this.matches[e][t]=!0;var i=this.statCache[r];i&&this.emit("stat",t,i),this.emit("match",t)}}},y.prototype._readdirInGlobStar=function(e,t){if(!this.aborted){if(this.follow)return this._readdir(e,!1,t);var r=this,s=c("lstat\0"+e,function(s,n){if(s&&"ENOENT"===s.code)return t();var i=n&&n.isSymbolicLink();r.symlinks[e]=i,i||!n||n.isDirectory()?r._readdir(e,!1,t):(r.cache[e]="FILE",t())});s&&r.fs.lstat(e,s)}},y.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=c("readdir\0"+e+"\0"+t,r))){if(t&&!a(this.symlinks,e))return this._readdirInGlobStar(e,r);if(a(this.cache,e)){var s,n,i=this.cache[e];if(!i||"FILE"===i)return r();if(Array.isArray(i))return r(null,i)}this.fs.readdir(e,(s=this,n=r,function(t,r){t?s._readdirError(e,t,n):s._readdirEntries(e,r,n)}))}},y.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var s=0;s<t.length;s++){var n=t[s];n="/"===e?e+n:e+"/"+n,this.cache[n]=!0}return this.cache[e]=t,r(null,t)}},y.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var s=this._makeAbs(e);if(this.cache[s]="FILE",s===this.cwdAbs){var n=Error(t.code+" invalid cwd "+this.cwd);n.path=this.cwd,n.code=t.code,this.emit("error",n),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t)}return r()}},y.prototype._processGlobStar=function(e,t,r,s,n,i,o){var a=this;this._readdir(r,i,function(c,l){a._processGlobStar2(e,t,r,s,n,i,l,o)})},y.prototype._processGlobStar2=function(e,t,r,s,n,i,o,a){if(!o)return a();var c=s.slice(1),l=e?[e]:[],u=l.concat(c);this._process(u,n,!1,a);var h=this.symlinks[r],d=o.length;if(h&&i)return a();for(var p=0;p<d;p++)if("."!==o[p].charAt(0)||this.dot){var m=l.concat(o[p],c);this._process(m,n,!0,a);var f=l.concat(o[p],s);this._process(f,n,!0,a)}a()},y.prototype._processSimple=function(e,t,r){var s=this;this._stat(e,function(n,i){s._processSimple2(e,t,n,i,r)})},y.prototype._processSimple2=function(e,t,r,s,i){if(this.matches[t]||(this.matches[t]=Object.create(null)),!s)return i();if(e&&n(e)&&!this.nomount){var o=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=E.join(this.root,e):(e=E.resolve(this.root,e),o&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),i()},y.prototype._stat=function(e,t){var r=this._makeAbs(e),s="/"===e.slice(-1);if(e.length>this.maxLength)return t();if(!this.stat&&a(this.cache,r)){var n=this.cache[r];if(Array.isArray(n)&&(n="DIR"),!s||"DIR"===n)return t(null,n);if(s&&"FILE"===n)return t()}var i=this.statCache[r];if(void 0!==i){if(!1===i)return t(null,i);var o=i.isDirectory()?"DIR":"FILE";return s&&"FILE"===o?t():t(null,o,i)}var l=this,u=c("stat\0"+r,function(s,n){if(n&&n.isSymbolicLink())return l.fs.stat(r,function(s,i){s?l._stat2(e,r,null,n,t):l._stat2(e,r,s,i,t)});l._stat2(e,r,s,n,t)});u&&l.fs.lstat(r,u)},y.prototype._stat2=function(e,t,r,s,n){if(r&&("ENOENT"===r.code||"ENOTDIR"===r.code))return this.statCache[t]=!1,n();var i="/"===e.slice(-1);if(this.statCache[t]=s,"/"===t.slice(-1)&&s&&!s.isDirectory())return n(null,!1,s);var o=!0;return(s&&(o=s.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,i&&"FILE"===o)?n():n(null,o,s)},g}(),r=e=>e&&e.search(/\S/)||0,s=e=>e&&e.search(/\S$/)||0;e.DefaultWatermarks={statements:[50,75],functions:[50,75],branches:[50,75],lines:[50,75]},e.DefaultReportOptions={clover:{file:"clover.xml",projectRoot:"."},cobertura:{file:"cobertura.xml",projectRoot:"."},"html-spa":{verbose:!1,skipEmpty:!1,subdir:"html-spa",linkMapper:void 0,metricsToShow:["lines","statements","branches"]},html:{verbose:!1,skipEmpty:!1,subdir:"html",linkMapper:void 0},json:{file:"coverage.json"},"json-summary":{file:"coverage-summary.json"},lcovonly:{file:"lcovonly.info",projectRoot:"."},none:{},teamcity:{file:"teamcity.txt",blockName:"coverage"},text:{file:"text.txt",maxCols:160,skipEmpty:!1,skipFull:!1},"text-summary":{file:"text-summary.txt"}};let CoverageReporter=class CoverageReporter{constructor(e,t,r,s){this.coverage=e,this.reportDir=t,this.sourceDir=r,this.options=s}generateReports(){var t,r;try{this.coverageMap=this.buildCoverageMap(),b.statSync(this.reportDir);let s=tr.createContext({dir:this.reportDir,defaultSummarizer:"nested",watermarks:(null===(t=this.options)||void 0===t?void 0:t.watermark)||e.DefaultWatermarks,coverageMap:this.coverageMap});((null===(r=this.options)||void 0===r?void 0:r.reportFormats)||["text-summary"]).forEach(t=>{var r;ts.create(t,(null===(r=this.options)||void 0===r?void 0:r.reportOptions[t])||e.DefaultReportOptions[t]).execute(s)})}catch(e){throw Error(N.nls.localize("coverageReportCreationError",e.message))}}buildCoverageMap(){let e=this.findFullPathToClass(["cls","trigger"]),t=eZ.createCoverageMap();return this.coverage.records.forEach(n=>{let i={},o=RegExp(`${n.ApexClassOrTrigger.Name}.(cls|trigger)`);i.fnMap={},i.branchMap={},i.path=E.join(this.sourceDir,e.find(e=>o.test(e))||n.ApexClassOrTrigger.Name),i.f={},i.b={},i.s=[...n.Coverage.coveredLines.map(e=>[e,1]),...n.Coverage.uncoveredLines.map(e=>[e,0])].map(([e,t])=>[Number(e).toString(10),t]).reduce((e,[t,r])=>Object.assign(e,{[t]:r}),{});let a=[];try{a=b.readFileSync(i.path,"utf8").split("\n")}catch(e){}i.statementMap=[...n.Coverage.coveredLines,...n.Coverage.uncoveredLines].sort().map(e=>{let t={start:{line:e,column:r(a[e-1])},end:{line:e,column:s(a[e-1])}};return[Number(e).toString(10),t]}).reduce((e,[t,r])=>Object.assign(e,{[Number(t).toString()]:r}),{}),t.addFileCoverage(i)}),t}findFullPathToClass(e){let r=`**/*.{${e.join(",")}}`;return t.glob.sync(r,{cwd:this.sourceDir})}};e.CoverageReporter=CoverageReporter}(ea),Object.defineProperty(ee,"__esModule",{value:!0}),ee.DefaultWatermarks=ee.DefaultReportOptions=ee.CoverageReporter=ee.HumanReporter=ee.JUnitReporter=ee.TapReporter=void 0,Object.defineProperty(ee,"TapReporter",{enumerable:!0,get:function(){return et.TapReporter}}),Object.defineProperty(ee,"JUnitReporter",{enumerable:!0,get:function(){return er.JUnitReporter}}),Object.defineProperty(ee,"HumanReporter",{enumerable:!0,get:function(){return eo.HumanReporter}}),Object.defineProperty(ee,"CoverageReporter",{enumerable:!0,get:function(){return ea.CoverageReporter}}),Object.defineProperty(ee,"DefaultReportOptions",{enumerable:!0,get:function(){return ea.DefaultReportOptions}}),Object.defineProperty(ee,"DefaultWatermarks",{enumerable:!0,get:function(){return ea.DefaultWatermarks}});var t5={},t8={},t6={};Object.defineProperty(t6,"__esModule",{value:!0}),t6.ApexTestQueueItemStatus=t6.ApexTestRunResultStatus=t6.ApexTestResultOutcome=t6.ResultFormat=t6.TestLevel=void 0,(r=t6.TestLevel||(t6.TestLevel={})).RunLocalTests="RunLocalTests",r.RunAllTestsInOrg="RunAllTestsInOrg",r.RunSpecifiedTests="RunSpecifiedTests",(s=t6.ResultFormat||(t6.ResultFormat={})).junit="junit",s.tap="tap",s.json="json",s.human="human",(n=t6.ApexTestResultOutcome||(t6.ApexTestResultOutcome={})).Pass="Pass",n.Fail="Fail",n.CompileFail="CompileFail",n.Skip="Skip",(i=t6.ApexTestRunResultStatus||(t6.ApexTestRunResultStatus={})).Queued="Queued",i.Processing="Processing",i.Aborted="Aborted",i.Passed="Passed",i.Failed="Failed",i.Completed="Completed",i.Skipped="Skipped",(o=t6.ApexTestQueueItemStatus||(t6.ApexTestQueueItemStatus={})).Holding="Holding",o.Queued="Queued",o.Preparing="Preparing",o.Processing="Processing",o.Aborted="Aborted",o.Completed="Completed",o.Failed="Failed";var t4={},t7={};Object.defineProperty(t7,"__esModule",{value:!0}),t7.TEST_RUN_ID_PREFIX=t7.CLASS_ID_PREFIX=t7.QUERY_RECORD_LIMIT=void 0,t7.QUERY_RECORD_LIMIT=500,t7.CLASS_ID_PREFIX="01p",t7.TEST_RUN_ID_PREFIX="707";var t9=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t4,"__esModule",{value:!0}),t4.queryNamespaces=t4.stringify=t4.calculatePercentage=t4.isValidApexClassID=t4.isValidTestRunID=void 0,t4.isValidTestRunID=function(e){return(15===e.length||18===e.length)&&e.startsWith(t7.TEST_RUN_ID_PREFIX)},t4.isValidApexClassID=function(e){return(15===e.length||18===e.length)&&e.startsWith(t7.CLASS_ID_PREFIX)},t4.calculatePercentage=function(e,t){let r="0%";if(e>0){let s=(e/t*100).toFixed();r=`${s}%`}return r},t4.stringify=function(e){return JSON.stringify(e,null,2)},t4.queryNamespaces=function(e){return t9(this,void 0,void 0,function*(){let t=e.query("SELECT NamespacePrefix FROM PackageLicense"),r=e.query("SELECT NamespacePrefix FROM Organization"),s=yield Promise.all([t,r]),n=s[0].records.map(e=>({installedNs:!0,namespace:e.NamespacePrefix}));return[...s[1].records.map(e=>({installedNs:!1,namespace:e.NamespacePrefix})),...n]})};var re={},rt={},rr={},rs={};Object.defineProperty(rs,"__esModule",{value:!0}),rs.RetreiveResultsInterval=rs.StreamingErrors=void 0,(a=rs.StreamingErrors||(rs.StreamingErrors={})).ERROR_AUTH_INVALID="401::Authentication invalid",a.ERROR_UNKNOWN_CLIENT_ID="403::Unknown client",rs.RetreiveResultsInterval=6e4;var rn=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(rr,"__esModule",{value:!0}),rr.StreamingClient=rr.Deferred=void 0;const ri=C.faye_node;let Deferred=class Deferred{constructor(){this.promise=new Promise(e=>this.resolve=e)}};rr.Deferred=Deferred;let StreamingClient=class StreamingClient{constructor(e,t){this.apiVersion="36.0",this.subscribedTestRunIdDeferred=new Deferred,this.hasDisconnected=!1,this.conn=e,this.progress=t;let r=this.getStreamURL(this.conn.instanceUrl);this.client=new ri.Client(r,{timeout:14400}),this.client.on("transport:up",()=>{var e;null===(e=this.progress)||void 0===e||e.report({type:"StreamingClientProgress",value:"streamingTransportUp",message:N.nls.localize("streamingTransportUp")})}),this.client.on("transport:down",()=>{var e;null===(e=this.progress)||void 0===e||e.report({type:"StreamingClientProgress",value:"streamingTransportDown",message:N.nls.localize("streamingTransportDown")})}),this.client.addExtension({incoming:(e,t)=>rn(this,void 0,void 0,function*(){if(e&&e.error){if("/meta/handshake"===e.channel)throw this.disconnect(),Error(N.nls.localize("streamingHandshakeFail",e.error));if("401::Authentication invalid"===e.error){yield this.init(),t(e);return}if(e.advice&&"handshake"===e.advice.reconnect||"403::Unknown client"===e.error){t(e);return}throw this.disconnect(),Error(e.error)}t(e)})})}get subscribedTestRunIdPromise(){return this.subscribedTestRunIdDeferred.promise}removeTrailingSlashURL(e){return e?e.replace(/\/+$/,""):""}getStreamURL(e){return[this.removeTrailingSlashURL(e),"cometd",this.apiVersion].join("/")}init(){return rn(this,void 0,void 0,function*(){yield(0,F.refreshAuth)(this.conn);let e=this.conn.getConnectionOptions().accessToken;if(e)this.client.setHeader("Authorization",`OAuth ${e}`);else throw Error(N.nls.localize("noAccessTokenFound"))})}handshake(){return new Promise(e=>{this.client.handshake(()=>{e()})})}disconnect(){this.client.disconnect(),this.hasDisconnected=!0}subscribe(e,t){return rn(this,void 0,void 0,function*(){return new Promise((r,s)=>{let n;try{this.client.subscribe("/systemTopic/TestResult",e=>rn(this,void 0,void 0,function*(){let t=yield this.handler(e);t&&(this.disconnect(),clearInterval(n),r({runId:this.subscribedTestRunId,queueItem:t}))})),e?e().then(e=>{this.subscribedTestRunId=e,this.subscribedTestRunIdDeferred.resolve(e),this.hasDisconnected||(n=setInterval(()=>rn(this,void 0,void 0,function*(){let t=yield this.getCompletedTestRun(e);t&&(this.disconnect(),clearInterval(n),r({runId:this.subscribedTestRunId,queueItem:t}))}),rs.RetreiveResultsInterval))}).catch(e=>{this.disconnect(),clearInterval(n),s(e)}):(this.subscribedTestRunId=t,this.subscribedTestRunIdDeferred.resolve(t),this.hasDisconnected||(n=setInterval(()=>rn(this,void 0,void 0,function*(){let e=yield this.getCompletedTestRun(t);e&&(this.disconnect(),clearInterval(n),r({runId:this.subscribedTestRunId,queueItem:e}))}),rs.RetreiveResultsInterval)))}catch(e){this.disconnect(),clearInterval(n),s(e)}})})}isValidTestRunID(e,t){if(15!==e.length&&18!==e.length)return!1;let r=e.substring(0,14);return!t||t.substring(0,14)===r}handler(e,t){var r;return rn(this,void 0,void 0,function*(){let s=t||e.sobject.Id;return this.isValidTestRunID(s,this.subscribedTestRunId)?(yield this.getCompletedTestRun(s))||(null===(r=this.progress)||void 0===r||r.report({type:"StreamingClientProgress",value:"streamingProcessingTestRun",message:N.nls.localize("streamingProcessingTestRun",s),testRunId:s}),null):null})}getCompletedTestRun(e){var t;return rn(this,void 0,void 0,function*(){let r=`SELECT Id, Status, ApexClassId, TestRunResultId FROM ApexTestQueueItem WHERE ParentJobId = '${e}'`,s=yield this.conn.tooling.query(r,{autoFetch:!0});if(0===s.records.length)throw Error(N.nls.localize("noTestQueueResults",e));null===(t=this.progress)||void 0===t||t.report({type:"TestQueueProgress",value:s});for(let e=0;e<s.records.length;e++){let t=s.records[e];if("Queued"===t.Status||"Holding"===t.Status||"Preparing"===t.Status||"Processing"===t.Status)return null}return s})}};rr.StreamingClient=StreamingClient,Object.defineProperty(rt,"__esModule",{value:!0}),rt.StreamingClient=void 0,Object.defineProperty(rt,"StreamingClient",{enumerable:!0,get:function(){return rr.StreamingClient}});var ro={};Object.defineProperty(ro,"__esModule",{value:!0}),ro.getAsyncDiagnostic=ro.getSyncDiagnostic=ro.formatTestErrors=void 0,ro.formatTestErrors=function(e){var t;let r=null===(t=e.message)||void 0===t?void 0:t.match(/\bsObject type ["'](.*?)["'] is not supported\b/);return r&&r[0]&&r[1]&&(e.message=N.nls.localize("invalidsObjectErr",[r[1],e.message])),e},ro.getSyncDiagnostic=function(e){let t={exceptionMessage:e.message,exceptionStackTrace:e.stackTrace,className:e.stackTrace?e.stackTrace.split(".")[1]:void 0,compileProblem:""},r=e.stackTrace&&e.stackTrace.match(/(line (\d+), column (\d+))/);return r&&(r[2]&&(t.lineNumber=Number(r[2])),r[3]&&(t.columnNumber=Number(r[3]))),t},ro.getAsyncDiagnostic=function(e){let t={exceptionMessage:e.Message,exceptionStackTrace:e.StackTrace,className:e.StackTrace?e.StackTrace.split(".")[1]:void 0,compileProblem:""},r=e.StackTrace&&e.StackTrace.match(/(line (\d+), column (\d+))/);return r&&(r[2]&&(t.lineNumber=Number(r[2])),r[3]&&(t.columnNumber=Number(r[3]))),t};var ra={},rc=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(ra,"__esModule",{value:!0}),ra.CodeCoverage=void 0;let CodeCoverage=class CodeCoverage{constructor(e){this.connection=e}getOrgWideCoverage(){return rc(this,void 0,void 0,function*(){let e=yield this.connection.tooling.query("SELECT PercentCovered FROM ApexOrgWideCoverage");return 0===e.records.length?"0%":`${e.records[0].PercentCovered}%`})}getPerClassCodeCoverage(e){return rc(this,void 0,void 0,function*(){if(0===e.size)return new Map;let t=yield this.queryPerClassCodeCov(e),r=new Map;return t.forEach(e=>{e.records.forEach(e=>{let t=e.NumLinesCovered+e.NumLinesUncovered,s=(0,t4.calculatePercentage)(e.NumLinesCovered,t),n=Object.assign({apexClassOrTriggerName:e.ApexClassOrTrigger.Name,apexClassOrTriggerId:e.ApexClassOrTrigger.Id,apexTestClassId:e.ApexTestClassId,apexTestMethodName:e.TestMethodName,numLinesCovered:e.NumLinesCovered,numLinesUncovered:e.NumLinesUncovered,percentage:s},e.Coverage?{coverage:e.Coverage}:{}),i=`${e.ApexTestClassId}-${e.TestMethodName}`;r.get(i)?r.get(i).push(n):r.set(`${e.ApexTestClassId}-${e.TestMethodName}`,[n])})}),r})}getAggregateCodeCoverage(e){return rc(this,void 0,void 0,function*(){if(0===e.size)return{codeCoverageResults:[],totalLines:0,coveredLines:0};let t=yield this.queryAggregateCodeCov(e),r=0,s=0,n=[];return t.forEach(e=>{let t=e.records.map(e=>{r+=e.NumLinesCovered,s+=e.NumLinesUncovered;let t=e.NumLinesCovered+e.NumLinesUncovered,n=(0,t4.calculatePercentage)(e.NumLinesCovered,t);return{apexId:e.ApexClassOrTrigger.Id,name:e.ApexClassOrTrigger.Name,type:e.ApexClassOrTrigger.Id.startsWith("01p")?"ApexClass":"ApexTrigger",numLinesCovered:e.NumLinesCovered,numLinesUncovered:e.NumLinesUncovered,percentage:n,coveredLines:e.Coverage.coveredLines,uncoveredLines:e.Coverage.uncoveredLines}});n.push(...t)}),{codeCoverageResults:n,totalLines:r+s,coveredLines:r}})}queryPerClassCodeCov(e){return rc(this,void 0,void 0,function*(){return this.fetchResults(e,"SELECT ApexTestClassId, ApexClassOrTrigger.Id, ApexClassOrTrigger.Name, TestMethodName, NumLinesCovered, NumLinesUncovered, Coverage FROM ApexCodeCoverage WHERE ApexTestClassId IN (%s)")})}queryAggregateCodeCov(e){return rc(this,void 0,void 0,function*(){return this.fetchResults(e,"SELECT ApexClassOrTrigger.Id, ApexClassOrTrigger.Name, NumLinesCovered, NumLinesUncovered, Coverage FROM ApexCodeCoverageAggregate WHERE ApexClassorTriggerId IN (%s)")})}fetchResults(e,t){return rc(this,void 0,void 0,function*(){let r=this.createQueries(t,e).map(e=>this.connection.tooling.query(e,{autoFetch:!0}));return yield Promise.all(r)})}createQueries(e,t){let r=[...t],s=[];for(let t=0;t<r.length;t+=t7.QUERY_RECORD_LIMIT){let n=r.slice(t,t+t7.QUERY_RECORD_LIMIT).map(e=>`'${e}'`),i=T.format(e,n.join(","));s.push(i)}return s}};ra.CodeCoverage=CodeCoverage;var rl=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(re,"__esModule",{value:!0}),re.AsyncTests=void 0;let AsyncTests=class AsyncTests{constructor(e){this.connection=e,this.codecoverage=new ra.CodeCoverage(this.connection)}runTests(e,t=!1,r=!1,s,n){return rl(this,void 0,void 0,function*(){try{let i=new rt.StreamingClient(this.connection,s);yield i.init(),yield i.handshake(),n&&n.onCancellationRequested(()=>rl(this,void 0,void 0,function*(){let e=yield i.subscribedTestRunIdPromise;yield this.abortTestRun(e,s),i.disconnect()}));let o=yield this.getTestRunRequestAction(e)();if(r)return{testRunId:o};if(n&&n.isCancellationRequested)return null;let a=yield i.subscribe(void 0,o),c=yield this.checkRunStatus(a.runId);return yield this.formatAsyncResults(a,(0,F.getCurrentTime)(),t,c,s)}catch(e){throw(0,ro.formatTestErrors)(e)}})}reportAsyncResults(e,t=!1,r){return rl(this,void 0,void 0,function*(){try{let s;let n=new rt.StreamingClient(this.connection);yield n.init(),yield n.handshake();let i=yield this.checkRunStatus(e);if(void 0!==i?s=yield n.handler(void 0,e):(s=(yield n.subscribe(void 0,e)).queueItem,i=yield this.checkRunStatus(e)),r&&r.onCancellationRequested(()=>rl(this,void 0,void 0,function*(){n.disconnect()})),r&&r.isCancellationRequested)return null;return yield this.formatAsyncResults({queueItem:s,runId:e},(0,F.getCurrentTime)(),t,i)}catch(e){throw(0,ro.formatTestErrors)(e)}})}checkRunStatus(e,t){return rl(this,void 0,void 0,function*(){if(!(0,t4.isValidTestRunID)(e))throw Error(N.nls.localize("invalidTestRunIdErr",e));let r="SELECT AsyncApexJobId, Status, ClassesCompleted, ClassesEnqueued, ";r+=`MethodsEnqueued, StartTime, EndTime, TestTime, UserId FROM ApexTestRunResult WHERE AsyncApexJobId = '${e}'`,null==t||t.report({type:"FormatTestResultProgress",value:"retrievingTestRunSummary",message:N.nls.localize("retrievingTestRunSummary")});let s=yield this.connection.tooling.query(r,{autoFetch:!0});if(0===s.records.length)throw Error(N.nls.localize("noTestResultSummary",e));if("Aborted"===s.records[0].Status||"Failed"===s.records[0].Status||"Completed"===s.records[0].Status||"Passed"===s.records[0].Status||"Skipped"===s.records[0].Status)return s.records[0]})}formatAsyncResults(e,t,r=!1,s,n){var i,o;return rl(this,void 0,void 0,function*(){let a=new Set,c=yield this.getAsyncTestResults(e.queueItem),{apexTestClassIdSet:l,testResults:u,globalTests:h}=yield this.buildAsyncTestResults(c),d=s.Status;h.failed>0?d="Failed":0===h.passed?d="Skipped":"Completed"===s.Status&&(d="Passed");let p={summary:{outcome:d,testsRan:u.length,passing:h.passed,failing:h.failed,skipped:h.skipped,passRate:(0,t4.calculatePercentage)(h.passed,u.length),failRate:(0,t4.calculatePercentage)(h.failed,u.length),skipRate:(0,t4.calculatePercentage)(h.skipped,u.length),testStartTime:(0,F.formatStartTime)(s.StartTime),testExecutionTimeInMs:null!==(i=s.TestTime)&&void 0!==i?i:0,testTotalTimeInMs:null!==(o=s.TestTime)&&void 0!==o?o:0,commandTimeInMs:(0,F.getCurrentTime)()-t,hostname:this.connection.instanceUrl,orgId:this.connection.getAuthInfoFields().orgId,username:this.connection.getUsername(),testRunId:e.runId,userId:s.UserId},tests:u};if(r){let e=yield this.codecoverage.getPerClassCodeCoverage(l);p.tests.forEach(t=>{let r=`${t.apexClass.id}-${t.methodName}`,s=e.get(r);s&&(s.forEach(e=>a.add(e.apexClassOrTriggerId)),t.perClassCoverage=s)}),null==n||n.report({type:"FormatTestResultProgress",value:"queryingForAggregateCodeCoverage",message:N.nls.localize("queryingForAggregateCodeCoverage")});let{codeCoverageResults:t,totalLines:r,coveredLines:s}=yield this.codecoverage.getAggregateCodeCoverage(a);p.codecoverage=t,p.summary.totalLines=r,p.summary.coveredLines=s,p.summary.testRunCoverage=(0,t4.calculatePercentage)(s,r),p.summary.orgWideCoverage=yield this.codecoverage.getOrgWideCoverage()}return p})}getAsyncTestResults(e){return rl(this,void 0,void 0,function*(){let t="SELECT Id, QueueItemId, StackTrace, Message, ";t+="RunTime, TestTimestamp, AsyncApexJobId, MethodName, Outcome, ApexLogId, ApexClass.Id, ApexClass.Name, ApexClass.NamespacePrefix FROM ApexTestResult WHERE QueueItemId IN (%s)";let r=e.records.map(e=>e.Id),s=[];for(let e=0;e<r.length;e+=t7.QUERY_RECORD_LIMIT){let n=r.slice(e,e+t7.QUERY_RECORD_LIMIT).map(e=>`'${e}'`),i=T.format(t,n.join(","));s.push(i)}let n=s.map(e=>this.connection.tooling.query(e,{autoFetch:!0}));return yield Promise.all(n)})}buildAsyncTestResults(e){return rl(this,void 0,void 0,function*(){let t=new Set,r=0,s=0,n=0,i=[];for(let o of e)o.records.forEach(e=>{var o;switch(e.Outcome){case"Pass":r++;break;case"Fail":case"CompileFail":s++;break;case"Skip":n++}t.add(e.ApexClass.Id),e.ApexClass.FullName=e.ApexClass.NamespacePrefix?`${e.ApexClass.NamespacePrefix}__${e.ApexClass.Name}`:e.ApexClass.Name;let a=e.Message||e.StackTrace?(0,ro.getAsyncDiagnostic)(e):null;i.push(Object.assign({id:e.Id,queueItemId:e.QueueItemId,stackTrace:e.StackTrace,message:e.Message,asyncApexJobId:e.AsyncApexJobId,methodName:e.MethodName,outcome:e.Outcome,apexLogId:e.ApexLogId,apexClass:{id:e.ApexClass.Id,name:e.ApexClass.Name,namespacePrefix:e.ApexClass.NamespacePrefix,fullName:e.ApexClass.FullName},runTime:null!==(o=e.RunTime)&&void 0!==o?o:0,testTimestamp:e.TestTimestamp,fullName:`${e.ApexClass.FullName}.${e.MethodName}`},a?{diagnostic:a}:{}))});return{apexTestClassIdSet:t,testResults:i,globalTests:{passed:r,failed:s,skipped:n}}})}abortTestRun(e,t){return rl(this,void 0,void 0,function*(){null==t||t.report({type:"AbortTestRunProgress",value:"abortingTestRun",message:N.nls.localize("abortingTestRun",e),testRunId:e});let r=yield this.connection.tooling.query(`SELECT Id, Status FROM ApexTestQueueItem WHERE ParentJobId = '${e}'`);for(let e of r.records)e.Status="Aborted";yield this.connection.tooling.update("ApexTestQueueItem",r.records),null==t||t.report({type:"AbortTestRunProgress",value:"abortingTestRunRequested",message:N.nls.localize("abortingTestRunRequested",e),testRunId:e})})}getTestRunRequestAction(e){return()=>rl(this,void 0,void 0,function*(){let t={method:"POST",url:`${this.connection.tooling._baseUrl()}/runTestsAsynchronous`,body:JSON.stringify(e),headers:{"content-type":"application/json"}};try{let e=yield this.connection.tooling.request(t);return Promise.resolve(e)}catch(e){return Promise.reject(e)}})}};re.AsyncTests=AsyncTests;var ru={},rh=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(ru,"__esModule",{value:!0}),ru.SyncTests=void 0;let SyncTests=class SyncTests{constructor(e){this.connection=e,this.codecoverage=new ra.CodeCoverage(this.connection)}runTests(e,t=!1,r){return rh(this,void 0,void 0,function*(){try{let s=`${this.connection.tooling._baseUrl()}/runTestsSynchronous`,n={method:"POST",url:s,body:JSON.stringify(e),headers:{"content-type":"application/json"}},i=yield this.connection.tooling.request(n);if(r&&r.isCancellationRequested)return null;return yield this.formatSyncResults(i,(0,F.getCurrentTime)(),t)}catch(e){throw(0,ro.formatTestErrors)(e)}})}formatSyncResults(e,t,r=!1){var s,n;return rh(this,void 0,void 0,function*(){let i=new Set,{apexTestClassIdSet:o,testResults:a}=this.buildSyncTestResults(e),c=e.failures.length,l=e.successes.length,u={summary:{outcome:0===c?"Passed":"Failed",testsRan:e.numTestsRun,passing:l,failing:c,skipped:0,passRate:(0,t4.calculatePercentage)(l,e.numTestsRun),failRate:(0,t4.calculatePercentage)(c,e.numTestsRun),skipRate:(0,t4.calculatePercentage)(0,e.numTestsRun),testStartTime:(0,F.formatStartTime)(t),testExecutionTimeInMs:null!==(s=e.totalTime)&&void 0!==s?s:0,testTotalTimeInMs:null!==(n=e.totalTime)&&void 0!==n?n:0,commandTimeInMs:(0,F.getCurrentTime)()-t,hostname:this.connection.instanceUrl,orgId:this.connection.getAuthInfoFields().orgId,username:this.connection.getUsername(),testRunId:"",userId:this.connection.getConnectionOptions().userId},tests:a};if(r){let e=yield this.codecoverage.getPerClassCodeCoverage(o);e.size>0&&u.tests.forEach(t=>{let r=`${t.apexClass.id}-${t.methodName}`,s=e.get(r);s&&(s.forEach(e=>i.add(e.apexClassOrTriggerId)),t.perClassCoverage=s)});let{codeCoverageResults:t,totalLines:r,coveredLines:s}=yield this.codecoverage.getAggregateCodeCoverage(i);u.codecoverage=t,u.summary.totalLines=r,u.summary.coveredLines=s,u.summary.testRunCoverage=(0,t4.calculatePercentage)(s,r),u.summary.orgWideCoverage=yield this.codecoverage.getOrgWideCoverage()}return u})}buildSyncTestResults(e){let t=[],r=new Set;return e.successes.forEach(s=>{var n;let i=s.namespace?`${s.namespace}__`:"";r.add(s.id),t.push({id:"",queueItemId:"",stackTrace:"",message:"",asyncApexJobId:"",methodName:s.methodName,outcome:"Pass",apexLogId:e.apexLogId,apexClass:{id:s.id,name:s.name,namespacePrefix:s.namespace,fullName:`${i}${s.name}`},runTime:null!==(n=s.time)&&void 0!==n?n:0,testTimestamp:"",fullName:`${i}${s.name}.${s.methodName}`})}),e.failures.forEach(s=>{var n;let i=s.namespace?`${s.namespace}__`:"";r.add(s.id);let o=s.message||s.stackTrace?(0,ro.getSyncDiagnostic)(s):null;t.push(Object.assign({id:"",queueItemId:"",stackTrace:s.stackTrace,message:s.message,asyncApexJobId:"",methodName:s.methodName,outcome:"Fail",apexLogId:e.apexLogId,apexClass:{id:s.id,name:s.name,namespacePrefix:s.namespace,fullName:`${i}${s.name}`},runTime:null!==(n=s.time)&&void 0!==n?n:0,testTimestamp:"",fullName:`${i}${s.name}.${s.methodName}`},o?{diagnostic:o}:{}))}),{apexTestClassIdSet:r,testResults:t}}};ru.SyncTests=SyncTests;var rd=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(t8,"__esModule",{value:!0}),t8.TestService=void 0;let TestService=class TestService{constructor(e){this.connection=e,this.syncService=new ru.SyncTests(e),this.asyncService=new re.AsyncTests(e)}retrieveAllSuites(){return rd(this,void 0,void 0,function*(){return(yield this.connection.tooling.query("SELECT id, TestSuiteName FROM ApexTestSuite")).records})}retrieveSuiteId(e){return rd(this,void 0,void 0,function*(){let t=yield this.connection.tooling.query(`SELECT id FROM ApexTestSuite WHERE TestSuiteName = '${e}'`);if(0!==t.records.length)return t.records[0].Id})}getOrCreateSuiteIds(e){return rd(this,void 0,void 0,function*(){let t=e.map(e=>rd(this,void 0,void 0,function*(){let t=yield this.retrieveSuiteId(e);return void 0===t?(yield this.connection.tooling.create("ApexTestSuite",{TestSuiteName:e})).id:t}));return yield Promise.all(t)})}getTestsInSuite(e,t){return rd(this,void 0,void 0,function*(){if(void 0===e&&void 0===t)throw Error(N.nls.localize("suitenameErr"));if(e&&void 0===(t=yield this.retrieveSuiteId(e)))throw Error(N.nls.localize("missingSuiteErr"));return(yield this.connection.tooling.query(`SELECT ApexClassId FROM TestSuiteMembership WHERE ApexTestSuiteId = '${t}'`)).records})}getApexClassIds(e){return rd(this,void 0,void 0,function*(){let t=e.map(e=>rd(this,void 0,void 0,function*(){let t=yield this.connection.tooling.query(`SELECT id, name FROM ApexClass WHERE Name = '${e}'`);if(0===t.records.length)throw Error(N.nls.localize("missingTestClassErr",e));return t.records[0].Id}));return yield Promise.all(t)})}buildSuite(e,t){return rd(this,void 0,void 0,function*(){let r=(yield this.getOrCreateSuiteIds([e]))[0],s=yield this.getTestsInSuite(void 0,r),n=yield this.getApexClassIds(t);yield Promise.all(n.map(i=>rd(this,void 0,void 0,function*(){let o=s.filter(e=>e.ApexClassId===i),a=t[n.indexOf(i)];o.length>0?console.log(N.nls.localize("testSuiteMsg",[a,e])):(yield this.connection.tooling.create("TestSuiteMembership",{ApexClassId:i,ApexTestSuiteId:r}),console.log(N.nls.localize("classSuiteMsg",[a,e])))})))})}runTestSynchronous(e,t=!1,r){return rd(this,void 0,void 0,function*(){return yield this.syncService.runTests(e,t,r)})}runTestAsynchronous(e,t=!1,r=!1,s,n){return rd(this,void 0,void 0,function*(){return yield this.asyncService.runTests(e,t,r,s,n)})}reportAsyncResults(e,t=!1,r){return rd(this,void 0,void 0,function*(){return yield this.asyncService.reportAsyncResults(e,t,r)})}writeResultFiles(e,t,r=!1){return rd(this,void 0,void 0,function*(){let{dirPath:s,resultFormats:n,fileInfos:i}=t,o=[],a=e.hasOwnProperty("summary")?e.summary.testRunId:e.testRunId;if(o.push({path:(0,E.join)(s,"test-run-id.txt"),content:a}),n){if(!e.hasOwnProperty("summary"))throw Error(N.nls.localize("runIdFormatErr"));for(let t of n){if(!(t in t6.ResultFormat))throw Error(N.nls.localize("resultFormatErr"));switch(t){case t6.ResultFormat.json:o.push({path:(0,E.join)(s,a?`test-result-${a}.json`:"test-result.json"),content:(0,t4.stringify)(e)});break;case t6.ResultFormat.tap:let r=new ee.TapReporter().format(e);o.push({path:(0,E.join)(s,`test-result-${a}-tap.txt`),content:r});break;case t6.ResultFormat.junit:let n=new ee.JUnitReporter().format(e);o.push({path:(0,E.join)(s,a?`test-result-${a}-junit.xml`:"test-result-junit.xml"),content:n})}}}if(r){if(!e.hasOwnProperty("summary"))throw Error(N.nls.localize("covIdFormatErr"));let t=e.tests.map(e=>e.perClassCoverage);o.push({path:(0,E.join)(s,`test-result-${a}-codecoverage.json`),content:(0,t4.stringify)(t)})}return null==i||i.forEach(e=>{o.push({path:(0,E.join)(s,e.filename),content:"string"!=typeof e.content?(0,t4.stringify)(e.content):e.content})}),(0,$.createFiles)(o),o.map(e=>e.path)})}buildSyncPayload(e,t,r){var s;return rd(this,void 0,void 0,function*(){try{if(t){let e=yield this.buildTestPayload(t),r=null===(s=e.tests)||void 0===s?void 0:s.map(e=>{if(e.className)return e.className});if(1!==new Set(r).size)throw Error(N.nls.localize("syncClassErr"));return e}if(r)return{tests:[{[(0,t4.isValidApexClassID)(r)?"classId":"className"]:r}],testLevel:e};throw Error(N.nls.localize("payloadErr"))}catch(e){throw(0,ro.formatTestErrors)(e)}})}buildAsyncPayload(e,t,r,s){return rd(this,void 0,void 0,function*(){try{if(t)return yield this.buildTestPayload(t);if(r)return yield this.buildAsyncClassPayload(r);return{suiteNames:s,testLevel:e}}catch(e){throw(0,ro.formatTestErrors)(e)}})}buildAsyncClassPayload(e){return rd(this,void 0,void 0,function*(){return{tests:e.split(",").map(e=>{let t=e.split(".");return t.length>1?{className:`${t[0]}.${t[1]}`}:{[(0,t4.isValidApexClassID)(e)?"classId":"className"]:e}}),testLevel:"RunSpecifiedTests"}})}buildTestPayload(e){return rd(this,void 0,void 0,function*(){let t;let r=e.split(","),s=[],n=[];for(let e of r)if(e.indexOf(".")>0){let r=e.split(".");if(3===r.length)n.includes(r[1])?s.forEach(e=>{e.className===`${r[1]}`&&(e.namespace=`${r[0]}`,e.testMethods.push(`${r[2]}`))}):(s.push({namespace:`${r[0]}`,className:`${r[1]}`,testMethods:[r[2]]}),n.push(r[1]));else{void 0===t&&(t=yield(0,t4.queryNamespaces)(this.connection));let e=t.find(e=>e.namespace===r[0]);e?e.installedNs?s.push({className:`${r[0]}.${r[1]}`}):s.push({namespace:`${r[0]}`,className:`${r[1]}`}):n.includes(r[0])?s.forEach(e=>{e.className===r[0]&&e.testMethods.push(r[1])}):(s.push({className:r[0],testMethods:[r[1]]}),n.push(r[0]))}}else{let t=(0,t4.isValidApexClassID)(e)?"classId":"className";s.push({[t]:e})}return{tests:s,testLevel:"RunSpecifiedTests"}})}};t8.TestService=TestService,Object.defineProperty(t5,"__esModule",{value:!0}),t5.TestLevel=t5.ResultFormat=t5.ApexTestResultOutcome=t5.ApexTestRunResultStatus=t5.TestService=void 0,Object.defineProperty(t5,"TestService",{enumerable:!0,get:function(){return t8.TestService}}),Object.defineProperty(t5,"ApexTestRunResultStatus",{enumerable:!0,get:function(){return t6.ApexTestRunResultStatus}}),Object.defineProperty(t5,"ApexTestResultOutcome",{enumerable:!0,get:function(){return t6.ApexTestResultOutcome}}),Object.defineProperty(t5,"ResultFormat",{enumerable:!0,get:function(){return t6.ResultFormat}}),Object.defineProperty(t5,"TestLevel",{enumerable:!0,get:function(){return t6.TestLevel}}),Object.defineProperty(x,"__esModule",{value:!0}),x.Table=x.TestService=x.TestLevel=x.ResultFormat=x.ApexTestRunResultStatus=x.ApexTestResultOutcome=x.DefaultWatermarks=x.DefaultReportOptions=x.CoverageReporter=x.HumanReporter=x.TapReporter=x.JUnitReporter=x.LogService=x.ExecuteService=x.CancellationTokenSource=void 0,Object.defineProperty(x,"CancellationTokenSource",{enumerable:!0,get:function(){return I.CancellationTokenSource}}),Object.defineProperty(x,"ExecuteService",{enumerable:!0,get:function(){return k.ExecuteService}}),c=function e(){var t;return p||(p=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.LISTENER_ABORTED_ERROR_NAME=Y.LOG_TIMER_LENGTH_MINUTES=Y.MAX_NUM_LOGS=Y.LOG_TYPE=Y.DEFAULT_DEBUG_LEVEL_NAME=Y.LogService=void 0,t=function(){if(d)return X;d=1;var t=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(X,"__esModule",{value:!0}),X.LogService=void 0;let r=C.exported,s=C.lib,n=function(){if(h)return Z;h=1;var t=y.commonjsGlobal&&y.commonjsGlobal.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})};Object.defineProperty(Z,"__esModule",{value:!0}),Z.TraceFlags=void 0;let r=e();let TraceFlags=class TraceFlags{constructor(e){this.connection=e}ensureTraceFlags(e){return t(this,void 0,void 0,function*(){let t=this.connection.getUsername();if(!t)throw Error(N.nls.localize("error_no_default_username"));let r=(yield this.getUserIdOrThrow(t)).Id,s=yield this.getTraceFlagForUser(r);if(s){if(!(yield this.updateDebugLevel(s.DebugLevelId)))return!1;let e=this.calculateExpirationDate(s.ExpirationDate?new Date(s.ExpirationDate):new Date);return yield this.updateTraceFlag(s.Id,e)}{let t=yield this.getDebugLevelId(e),s=this.calculateExpirationDate(new Date);if(!(yield this.createTraceFlag(r,t,s)))return!1}return!0})}getDebugLevelId(e){return t(this,void 0,void 0,function*(){let t;if(e){if(!(t=yield this.findDebugLevel(e)))throw Error(N.nls.localize("trace_flags_failed_to_find_debug_level",e))}else if(!(t=yield this.createDebugLevel(r.DEFAULT_DEBUG_LEVEL_NAME)))throw Error(N.nls.localize("trace_flags_failed_to_create_debug_level"));return t})}findDebugLevel(e){return t(this,void 0,void 0,function*(){let t=(0,W.escapeXml)(e),r=`SELECT Id FROM DebugLevel WHERE DeveloperName = '${t}'`,s=yield this.connection.tooling.query(r);return s.totalSize&&s.totalSize>0&&s.records?s.records[0].Id:void 0})}updateDebugLevel(e){return t(this,void 0,void 0,function*(){return(yield this.connection.tooling.update("DebugLevel",{Id:e,ApexCode:"FINEST",Visualforce:"FINER"})).success})}createDebugLevel(e){return t(this,void 0,void 0,function*(){let t=yield this.connection.tooling.create("DebugLevel",{developerName:e,MasterLabel:e,ApexCode:"FINEST",Visualforce:"FINER"});return t.success&&t.id?t.id:void 0})}updateTraceFlag(e,r){return t(this,void 0,void 0,function*(){let t={Id:e,StartDate:Date.now(),ExpirationDate:r.toUTCString()};return(yield this.connection.tooling.update("TraceFlag",t)).success})}createTraceFlag(e,s,n){return t(this,void 0,void 0,function*(){let t={tracedentityid:e,logtype:r.LOG_TYPE,debuglevelid:s,StartDate:Date.now(),ExpirationDate:n.toUTCString()},i=yield this.connection.tooling.create("TraceFlag",t);return i.success&&i.id?i.id:void 0})}isValidDateLength(e){let t=Date.now();return e.getTime()-t>r.LOG_TIMER_LENGTH_MINUTES*q.MILLISECONDS_PER_MINUTE}calculateExpirationDate(e){return this.isValidDateLength(e)||(e=new Date(Date.now()+r.LOG_TIMER_LENGTH_MINUTES*q.MILLISECONDS_PER_MINUTE)),e}getUserIdOrThrow(e){return t(this,void 0,void 0,function*(){let t=(0,W.escapeXml)(e),r=`SELECT Id FROM User WHERE username='${t}'`,s=yield this.connection.query(r);if(0===s.totalSize)throw Error(N.nls.localize("trace_flags_unknown_user"));return s.records[0]})}getTraceFlagForUser(e){return t(this,void 0,void 0,function*(){let t=`
      SELECT Id, logtype, startdate, expirationdate, debuglevelid, debuglevel.apexcode, debuglevel.visualforce
      FROM TraceFlag
      WHERE logtype='${r.LOG_TYPE}' AND TracedEntityId='${e}'
      ORDER BY CreatedDate DESC
      LIMIT 1
    `,s=yield this.connection.tooling.query(t);if(s.totalSize>0)return s.records[0]})}};return Z.TraceFlags=TraceFlags,Z}();let LogService=class LogService{constructor(e){this.connection=e}getLogIds(e){return t(this,void 0,void 0,function*(){if(!("string"==typeof e.logId||"number"==typeof e.numberOfLogs))throw Error(N.nls.localize("missingInfoLogError"));return"number"==typeof e.numberOfLogs?(yield this.getLogRecords(e.numberOfLogs)).map(e=>e.Id):[e.logId]})}getLogs(e){return t(this,void 0,void 0,function*(){let r=yield this.getLogIds(e),s=[],n=r.map(r=>t(this,void 0,void 0,function*(){let t=`${this.connection.tooling._baseUrl()}/sobjects/ApexLog/${r}/Body`,n=yield this.toolingRequest(t);if(e.outputDir){let t=E.join(e.outputDir,`${r}.log`);s.push(t),(0,F.createFile)(t,n)}return String(n)})),i=yield Promise.all(n);if(s.length>0){let e=[];for(let t=0;t<i.length;t++)e.push({log:i[t],logPath:s[t]});return e}return i.map(e=>({log:e}))})}getLogById(e){return t(this,void 0,void 0,function*(){let t=this.connection.tooling._baseUrl(),r=`${t}/sobjects/ApexLog/${e}/Body`;return{log:(yield this.connection.tooling.request(r)).toString()||""}})}getLogRecords(e){return t(this,void 0,void 0,function*(){let t=`
        SELECT Id, Application, DurationMilliseconds, Location, LogLength, LogUser.Name,
          Operation, Request, StartTime, Status
        FROM ApexLog
        ORDER BY StartTime DESC
      `;if("number"==typeof e){if(e<=0)throw Error(N.nls.localize("numLogsError"));e=Math.min(e,K.MAX_NUM_LOGS),t+=` LIMIT ${e}`}return(yield this.connection.tooling.query(t)).records})}tail(e,s){return t(this,void 0,void 0,function*(){this.logger=yield r.Logger.child("apexLogApi",{tag:"tail"}),this.logTailer=s;let n=yield this.createStreamingClient(e);this.logger.debug(N.nls.localize("startHandshake")),yield n.handshake(),this.logger.debug(N.nls.localize("finishHandshake")),yield n.subscribe(()=>t(this,void 0,void 0,function*(){this.logger.debug(N.nls.localize("subscribeStarted"))}))})}createStreamingClient(e){return t(this,void 0,void 0,function*(){let t=new r.StreamingClient.DefaultOptions(e,K.STREAMING_LOG_TOPIC,this.streamingCallback.bind(this));return t.setSubscribeTimeout(s.Duration.minutes(K.LOG_TIMER_LENGTH_MINUTES)),yield r.StreamingClient.create(t)})}logCallback(e){return t(this,void 0,void 0,function*(){if(e.sobject&&e.sobject.Id){let t=yield this.getLogById(e.sobject.Id);t&&this.logTailer&&this.logTailer(t.log)}})}streamingCallback(e){var t;return e.errorName===K.LISTENER_ABORTED_ERROR_NAME?{completed:!0}:((null===(t=e.sobject)||void 0===t?void 0:t.Id)&&this.logCallback(e),{completed:!1})}prepareTraceFlag(e){return t(this,void 0,void 0,function*(){let t=new n.TraceFlags(this.connection);yield t.ensureTraceFlags(e)})}toolingRequest(e){return t(this,void 0,void 0,function*(){return yield this.connection.tooling.request(e)})}};return X.LogService=LogService,X}(),Object.defineProperty(Y,"LogService",{enumerable:!0,get:function(){return t.LogService}}),Object.defineProperty(Y,"DEFAULT_DEBUG_LEVEL_NAME",{enumerable:!0,get:function(){return K.DEFAULT_DEBUG_LEVEL_NAME}}),Object.defineProperty(Y,"LOG_TYPE",{enumerable:!0,get:function(){return K.LOG_TYPE}}),Object.defineProperty(Y,"MAX_NUM_LOGS",{enumerable:!0,get:function(){return K.MAX_NUM_LOGS}}),Object.defineProperty(Y,"LOG_TIMER_LENGTH_MINUTES",{enumerable:!0,get:function(){return K.LOG_TIMER_LENGTH_MINUTES}}),Object.defineProperty(Y,"LISTENER_ABORTED_ERROR_NAME",{enumerable:!0,get:function(){return K.LISTENER_ABORTED_ERROR_NAME}})),Y}(),Object.defineProperty(x,"LogService",{enumerable:!0,get:function(){return c.LogService}}),Object.defineProperty(x,"JUnitReporter",{enumerable:!0,get:function(){return ee.JUnitReporter}}),Object.defineProperty(x,"TapReporter",{enumerable:!0,get:function(){return ee.TapReporter}}),Object.defineProperty(x,"HumanReporter",{enumerable:!0,get:function(){return ee.HumanReporter}}),Object.defineProperty(x,"CoverageReporter",{enumerable:!0,get:function(){return ee.CoverageReporter}}),Object.defineProperty(x,"DefaultReportOptions",{enumerable:!0,get:function(){return ee.DefaultReportOptions}}),Object.defineProperty(x,"DefaultWatermarks",{enumerable:!0,get:function(){return ee.DefaultWatermarks}}),Object.defineProperty(x,"ApexTestResultOutcome",{enumerable:!0,get:function(){return t5.ApexTestResultOutcome}}),Object.defineProperty(x,"ApexTestRunResultStatus",{enumerable:!0,get:function(){return t5.ApexTestRunResultStatus}}),Object.defineProperty(x,"ResultFormat",{enumerable:!0,get:function(){return t5.ResultFormat}}),Object.defineProperty(x,"TestLevel",{enumerable:!0,get:function(){return t5.TestLevel}}),Object.defineProperty(x,"TestService",{enumerable:!0,get:function(){return t5.TestService}}),Object.defineProperty(x,"Table",{enumerable:!0,get:function(){return F.Table}});var rp=(l={__proto__:null},[x].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in l)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(l,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(l));exports.index=rp;
